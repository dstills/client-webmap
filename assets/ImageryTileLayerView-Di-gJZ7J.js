import{E as r,F as i,cN as I,J as j,b as R,b0 as P}from"./index-HSyhVbHY.js";import{s as T,v as V}from"./rasterProjectionHelper-B1L3D3vn.js";import{p as L}from"./popupUtils-2vg8rKMo.js";const O=b=>{let t=class extends b{constructor(){super(...arguments),this._rasterFieldPrefix="Raster.",this.layer=null,this.view=null,this.tileInfo=null}get fullExtent(){return this._getfullExtent()}_getfullExtent(){return T(this.layer.serviceRasterInfo,this.view.spatialReference)}get hasTilingEffects(){return!!(this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment)}get datumTransformation(){return V(this.layer.fullExtent,this.view.spatialReference,!0)}supportsSpatialReference(o){return!!T(this.layer.serviceRasterInfo,o)}async fetchPopupFeaturesAtLocation(o,u){const{layer:e}=this;if(!o)throw new R("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:e});const{popupEnabled:m}=e,h=L(e,u);if(!m||h==null)throw new R("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:m,popupTemplate:h});const g=[],{value:l,magdirValue:s,processedValue:y}=await e.identify(o,{timeExtent:this.timeExtent,signal:u==null?void 0:u.signal});let p="";if(l&&l.length){p=e.type==="imagery-tile"&&e.hasStandardTime()&&l[0]!=null?l.map(d=>e.getStandardTimeValue(d)).join(", "):l.join(", ");const n={ObjectId:0},v="Raster.ServicePixelValue";n[v]=e.type==="imagery-tile"&&e.raster.datasetFormat==="Function"?y==null?void 0:y.join(", "):p,n[v+".Raw"]=p;const w=e.serviceRasterInfo.attributeTable;if(w!=null){const{fields:d,features:F}=w,x=d.find(({name:a})=>a.toLowerCase()==="value"),c=x?F.find(a=>String(a.attributes[x.name])===p):null;if(c)for(const a in c.attributes)c.attributes.hasOwnProperty(a)&&(n[this._rasterFieldPrefix+a]=c.attributes[a])}const E=e.serviceRasterInfo.dataType;E!=="vector-magdir"&&E!=="vector-uv"||(n["Raster.Magnitude"]=s==null?void 0:s[0],n["Raster.Direction"]=s==null?void 0:s[1]);const f=new P(this.fullExtent.clone(),null,n);f.layer=e,f.sourceLayer=f.layer,g.push(f)}return g}};return r([i()],t.prototype,"layer",void 0),r([i(I)],t.prototype,"timeExtent",void 0),r([i()],t.prototype,"view",void 0),r([i()],t.prototype,"fullExtent",null),r([i()],t.prototype,"tileInfo",void 0),r([i({readOnly:!0})],t.prototype,"hasTilingEffects",null),r([i()],t.prototype,"datumTransformation",null),t=r([j("esri.views.layers.ImageryTileLayerView")],t),t};export{O as p};
