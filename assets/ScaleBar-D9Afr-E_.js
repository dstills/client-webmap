import{E as u,F as b,J as k,O as x,fd as f,hz as R,q2 as O,g as P,bZ as j,q3 as F,a7 as W,bY as C,cq as w,R as U,j0 as I,j1 as q,bt as z,lm as D,aT as G,j3 as d,nF as B,cj as N}from"./index-BS4ejk0L.js";import{e as V}from"./defaultUnit-DgRQNz8q.js";import{w as Y,v as E}from"./geodesicUtils-CnTg9Ebr.js";import"./getDefaultUnitForView-n2jWYNVB.js";const o="esri-scale-bar",s={base:o,labelContainer:`${o}__label-container`,rulerLabelContainer:`${o}__label-container--ruler`,lineLabelContainer:`${o}__label-container--line`,topLabelContainer:`${o}__label-container--top`,bottomLabelContainer:`${o}__label-container--bottom`,label:`${o}__label`,line:`${o}__line`,topLine:`${o}__line--top`,bottomLine:`${o}__line--bottom`,ruler:`${o}__ruler`,rulerBlock:`${o}__ruler-block`,barContainer:`${o}__bar-container`,rulerBarContainer:`${o}__bar-container--ruler`,lineBarContainer:`${o}__bar-container--line`};function H(e){return e>.5?{min:.5,max:1}:e>.2?{min:.2,max:.5}:{min:.1,max:.2}}function J(e,t){switch(t){case"metric":return e>1e3?{distance:w(e,"meters","kilometers"),unit:"kilometer"}:e>1?{distance:e,unit:"meter"}:e>.01?{distance:w(e,"meters","centimeters"),unit:"centimeter"}:{distance:w(e,"meters","millimeters"),unit:"millimeter"};case"imperial":case"non-metric":return e>1609.344?{distance:w(e,"meters","miles"),unit:"mile"}:e>.3048?{distance:w(e,"meters","feet"),unit:"foot"}:{distance:w(e,"meters","inches"),unit:"inch"}}}function T(e){var r;const{isWebMercator:t,wkt:i,wkt2:n}=e;return t||(((r=n||i)==null?void 0:r.includes("WGS_1984_Web_Mercator"))??!1)}function M({state:{paddedViewState:e},spatialReference:t,width:i}){return t.isWrappable&&e.worldScreenWidth<i}function S(e,t){const{x:i,y:n}=e?U(t,!0):t;return[i,n]}let _=class extends x{constructor(t){super(t),this.scaleComputedFrom=f(),this.view=null}get state(){var t,i;return(t=this.view)!=null&&t.ready&&((i=this.view)==null?void 0:i.type)==="2d"?"ready":"disabled"}getScaleBarProperties(t,i){if(this.state==="disabled"||isNaN(t)||!i||!this.view)return null;const n=this._getDistanceInMeters();return n==null?null:this._getScaleBarProps(t,n,i)}_getDistanceInMeters(){const{state:t,spatialReference:i}=this.view;if(!R(i))return null;const{isGeographic:n}=i,r=T(i);if(!n&&!r)return t.extent.width*(O(i)??1);const[l,c]=this._getScaleMeasuringPoints(),p=r||n&&!Y(i)?P.WGS84:i,m=new j({paths:[[S(r,l),S(r,c)]],spatialReference:p}),a=F(m,10);let h;try{[h]=E([a],"meters")}catch{return null}return h}_getScaleMeasuringPoints(){const t=this.view,{width:i,height:n,position:r,spatialReference:l}=t;if(M(t)){const a=W(l),{valid:h}=a;return[new C(h[0],0,l),new C(h[1],0,l)]}let c=this.scaleComputedFrom.y-r[1];c>n?c=n:c<0&&(c=0);const p=f(0,c),m=f(i,c);return[t.toMap(p),t.toMap(m)]}_getScaleBarProps(t,i,n){const r=this.view,l=t*i/(M(r)?r.state.paddedViewState.worldScreenWidth:r.width);if(l<.001)return null;const c=J(l,n),{distance:p,unit:m}=c;let a=p,h=0;for(;a>=1;)a/=10,h++;const{min:g,max:$}=H(a),y=$/a>=a/g?g:$;return{length:t*(y/a),value:10**h*y,unit:m}}};u([b()],_.prototype,"scaleComputedFrom",void 0),u([b({readOnly:!0})],_.prototype,"state",null),u([b()],_.prototype,"view",void 0),_=u([k("esri.widgets.ScaleBar.ScaleBarViewModel")],_);const X=_;function L(e,t){return N(e,{style:"unit",unit:t,unitDisplay:"short"})}let v=class extends q{constructor(e,t){super(e,t),this.messages=null,this.style="line",this.viewModel=new X}initialize(){this.addHandles(z(()=>{const{view:e}=this;return[e==null?void 0:e.stationary,e==null?void 0:e.center,e==null?void 0:e.scale,e==null?void 0:e.zoom]},([e])=>{e&&this.scheduleRender()}))}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get unit(){return this._defaultUnit}set unit(e){e==="non-metric"&&D(G.getLogger(this),"unit",{replacement:"Please use 'imperial' instead of 'non-metric'.",see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-ScaleBar.html#unit",version:"4.27",warnOnce:!0}),this._overrideIfSome("unit",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.viewModel.state==="disabled",t={[B.disabled]:e};let i,n;if(!e){const{unit:r,style:l}=this,c=r==="metric"||r==="dual",p=100,m=r==="dual"?"line":l;if(r==="imperial"||r==="non-metric"||r==="dual"){const a=this.viewModel.getScaleBarProperties(p,"imperial");a&&(n=m==="ruler"?this._renderRuler(a):this._renderLine(a,"bottom"))}if(c){const a=this.viewModel.getScaleBarProperties(p,"metric");a&&(i=m==="ruler"?this._renderRuler(a):this._renderLine(a,"top"))}}return d("div",{afterCreate:this._handleRootCreateOrUpdate,afterUpdate:this._handleRootCreateOrUpdate,bind:this,class:this.classes(s.base,B.widget,t)},i,n)}_renderRuler(e){const{length:t,unit:i,value:n}=e,r=Math.round(t),l=L(n,i);return d("div",{class:this.classes(s.barContainer,s.rulerBarContainer),key:s.rulerBarContainer},d("div",{class:s.ruler,styles:{width:`${r}px`}},d("div",{class:s.rulerBlock}),d("div",{class:s.rulerBlock}),d("div",{class:s.rulerBlock}),d("div",{class:s.rulerBlock})),d("div",{class:this.classes(s.labelContainer,s.rulerLabelContainer)},d("div",{class:s.label},"0"),d("div",{class:s.label},l)))}_renderLine(e,t){const{length:i,unit:n,value:r}=e,l=Math.round(i),c=L(r,n),p={[s.topLabelContainer]:t==="top",[s.bottomLabelContainer]:t==="bottom"},m=d("div",{class:this.classes(s.labelContainer,s.lineLabelContainer,p),key:s.labelContainer},d("div",{class:s.label},c)),a={[s.topLine]:t==="top",[s.bottomLine]:t==="bottom"},h=d("div",{class:this.classes(s.line,a),key:s.line,styles:{width:`${l}px`}});return d("div",{class:this.classes(s.barContainer,s.lineBarContainer),key:s.lineBarContainer},[h,m])}_handleRootCreateOrUpdate(e){if(!this.viewModel)return;const{scaleComputedFrom:t}=this.viewModel,i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset,l=f(n,r);(l.x!==t.x||l.y!==t.y)&&(this.viewModel.scaleComputedFrom=l)}};u([b(V)],v.prototype,"_defaultUnit",void 0),u([b()],v.prototype,"label",null),u([b(),I("esri/widgets/ScaleBar/t9n/ScaleBar")],v.prototype,"messages",void 0),u([b({type:["ruler","line"]})],v.prototype,"style",void 0),u([b({type:["metric","imperial","dual","non-metric"]})],v.prototype,"unit",null),u([b()],v.prototype,"view",null),u([b()],v.prototype,"viewModel",void 0),v=u([k("esri.widgets.ScaleBar")],v);const te=v;export{te as default};
