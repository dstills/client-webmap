import{aO as u,bB as m,fG as c,ar as y,aK as f,kK as g,g as w,i as V}from"./index-BhDz4nJ7.js";import{m as v}from"./LayerView2D-CnHSL2ze.js";import{u as C}from"./LayerView-C77uL6vR.js";import"./Container-BXVidpqz.js";import"./highlightReasons-oPQR33ZA.js";import"./Tile-Bw3qZqtY.js";import"./quickselect-C4F3mpYw.js";import"./ClipRect-IkMaETau.js";const d=Symbol();let l=class extends v(C){constructor(){super(...arguments),this.layerViews=new u,this._debouncedUpdate=m(async()=>{const{layer:e,parent:{footprintLayerView:i}}=this;let s=[];if(i){const n=this._createQuery(),{features:o}=await i.queryFeatures(n);this.suspended||(s=o.map(a=>e.acquireLayer(a)))}this.removeHandles(d),this.addHandles(s,d)})}attach(){this.addAttachHandles([this._updatingHandles.addOnCollectionChange(()=>this.layerViews,()=>this._updateStageChildren(),{initial:!0}),c(()=>{var e;return((e=this.parent.footprintLayerView)==null?void 0:e.dataUpdating)===!1},()=>this._updateLayers()),y(()=>{var e;return[this.layer.maximumVisibleSublayers,this.suspended,(e=this.parent.footprintLayerView)==null?void 0:e.filter]},()=>this._updateLayers())])}detach(){this.container.removeAllChildren(),this.removeHandles(d)}update(e){}moveStart(){}viewChange(){}moveEnd(){}isUpdating(){return this.layerViews.some(e=>e.updating)}_updateStageChildren(){this.container.removeAllChildren(),this.layerViews.forEach((e,i)=>this.container.addChildAt(e.container,i))}_updateLayers(){this.suspended?this.removeHandles(d):this._updatingHandles.addPromise(this._debouncedUpdate().catch(e=>{f.getLogger(this).error(e)}))}_createQuery(){const{parent:{footprintLayerView:e},layer:{maximumVisibleSublayers:i,parent:{itemTypeField:s,itemSourceField:n,objectIdField:o,orderBy:a}}}=this,p=`${s} <> 'Scene Service'`,t=e.createQuery();t.returnGeometry=!1,t.num=i,t.outFields=[o,n],t.where=g(t.where,p);const r=a==null?void 0:a.find(h=>h.field&&!h.valueExpression);return r!=null&&r.field&&(t.orderByFields=[`${r.field} ${r.order==="descending"?"DESC":"ASC"}`]),t}};l=w([V("esri.views.2d.layers.CatalogDynamicGroupLayerView2D")],l);const A=l;export{A as default};
