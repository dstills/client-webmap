import{E as a,F as s,J as f,O as S,j0 as D,j1 as B,nF as F,j3 as d,bZ as N,nG as I,c1 as U}from"./index-D2dWKXoe.js";let g=class extends S{constructor(e){super(e),this.average=null,this.bins=null,this.max=null,this.min=null}get binRange(){const{bins:e}=this;return e&&e.length>1?e[e.length-1].maxValue-e[0].minValue:0}set labelFormatFunction(e){this._set("labelFormatFunction",e)}get range(){const{max:e,min:t}=this;return e!=null&&t!=null?e-t:0}get state(){const{bins:e,range:t}=this;return t>0&&(e!=null&&e.length)?"ready":"disabled"}};a([s()],g.prototype,"average",void 0),a([s()],g.prototype,"bins",void 0),a([s({readOnly:!0})],g.prototype,"binRange",null),a([s()],g.prototype,"labelFormatFunction",null),a([s()],g.prototype,"max",void 0),a([s()],g.prototype,"min",void 0),a([s({readOnly:!0})],g.prototype,"range",null),a([s({readOnly:!0})],g.prototype,"state",null),g=a([f("esri.widgets.Histogram.HistogramViewModel")],g);const V=g;var v;const c="esri-histogram",u={base:c,widgetIcon:U.edit,horizontalLayout:`${c}--horizontal`,verticalLayout:`${c}--vertical`,content:`${c}__content`,svg:`${c}__svg`,bar:`${c}__bar`,bars:`${c}__bars`,label:`${c}__label`,dataLines:`${c}__data-lines`,dataLinesSubgroup:`${c}__data-lines-subgroup`,dataLine:`${c}__data-line`,averageLabel:`${c}__average-label`,averageDataLine:`${c}__average-data-line`,averageSymbol:`${c}__average-symbol`};let l=v=class extends B{constructor(e,t){super(e,t),this._bgFillId=`${this.id}-bg-fill`,this._containerNode=null,this._containerDimensions={width:0,height:0},this._defaultBarColor="#d8d8d8",this.barCreatedFunction=null,this.dataLines=null,this.dataLineCreatedFunction=null,this.dataLineUpdatedFunction=null,this.messages=null,this.viewModel=new V}get average(){return this.viewModel.average}set average(e){this.viewModel.average=e}get bins(){return this.viewModel.bins}set bins(e){this.viewModel.bins=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get labelFormatFunction(){return this.viewModel.labelFormatFunction}set labelFormatFunction(e){this.viewModel.labelFormatFunction=e}set layout(e){e!=="vertical"&&(e="horizontal"),this._set("layout",e)}get max(){return this.viewModel.max}set max(e){this.viewModel.max=e}get min(){return this.viewModel.min}set min(e){this.viewModel.min=e}get state(){return this.viewModel.state}static fromHistogramResult(e){const{bins:t,maxValue:i,minValue:n}=e;return new v({bins:t,max:i,min:n})}render(){const{label:e,layout:t,state:i}=this,n=this.classes(u.base,F.widget,t==="horizontal"?u.horizontalLayout:u.verticalLayout,i==="disabled"?F.disabled:null);return d("div",{afterCreate:this._afterContainerNodeCreate,"aria-label":e,bind:this,class:n},i==="ready"?this._renderContent():null)}_renderContent(){if(!this._containerNode)return;const e=this._bgFillId,t=`clip-path: url(#${e})`;return d("div",{class:u.content},d("svg",{class:u.svg,xmlns:"http://www.w3.org/2000/svg"},d("defs",null,this._renderFillDefinition(e)),d("g",{style:t},this._renderBarsGroup()),this._renderLinesGroup()))}_renderBarsGroup(){return d("g",{class:this.classes(u.bars)},this._renderBars())}_renderBars(){const{layout:e,viewModel:{binRange:t,range:i}}=this;if(!t||!i)return;const n=t/i,{width:r,height:o}=this._containerDimensions;if(o===0&&r===0)return;if(o===0&&r!==0)return void this.scheduleRender();const[h,p]=e==="vertical"?[o*n,r]:[o,r*n];return this._getBarDimensions(h,p).map(([b,_],m)=>this._renderBar(m,b,_))}_renderBar(e,t,i){const{bins:n,layout:r,max:o,messages:h,viewModel:{range:p}}=this;if(!n||o==null)return;const{width:b,height:_}=this._containerDimensions,m=n.slice()[e],{count:w,maxValue:y,minValue:x}=m,L=o-y,[C,$]=r==="vertical"?[0,L*(_/p)]:[b-i-L*(b/p),_-t],M=N(h.barLabel,{count:w,maxValue:y,minValue:x});return d("rect",{afterCreate:this._afterBarCreate,"aria-label":M,bind:this,class:u.bar,"data-index":e,fill:this._defaultBarColor,height:t,role:"img","shape-rendering":"crispEdges","stroke-width":"0",width:i,x:C,y:$})}_renderLinesGroup(){return d("g",{class:this.classes(u.dataLines)},this._renderAverageLine(),this._renderCustomLines())}_renderAverageLine(){const{average:e}=this;if(e==null)return;const t=[d("tspan",{class:this.classes(u.averageSymbol)},"xÌ„ "),d("tspan",{class:this.classes(u.averageLabel)},this.labelFormatFunction?this.labelFormatFunction(e,"average"):e)];return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(u.dataLinesSubgroup)},d("title",{key:"title"},e),this._renderLine(e,this.classes(u.averageDataLine)),this._renderLabel({label:t,value:e}))}_renderCustomLines(){var e;if((e=this.dataLines)!=null&&e.length)return this.dataLines.map((t,i)=>this._renderLineSubgroup(t,i))}_renderLineSubgroup(e,t){const{value:i}=e;return d("g",{afterCreate:this._afterLinesSubgroupCreate,afterUpdate:this._afterLinesSubgroupUpdate,bind:this,class:this.classes(u.dataLinesSubgroup),"data-index":t},d("title",{key:"title"},i),this._renderLine(i),this._renderLabel(e))}_renderLine(e,t){const[i,n,r,o]=this._getLinePosition(e);return d("line",{class:this.classes(u.dataLine,t),"shape-rendering":"crispEdges",x1:i,x2:n,y1:r,y2:o})}_renderLabel(e,t){const{label:i,value:n}=e,[r,o]=this._getLabelPosition(n);return d("text",{class:this.classes(u.label,t),"text-anchor":"end",transform:this.layout==="horizontal"?"rotate(270)":null,x:r,y:o-2},i??"")}_renderFillDefinition(e){const{width:t,height:i}=this._containerDimensions;return d("clipPath",{id:e},d("rect",{height:i,width:t,x:"0",y:"0"}))}_afterContainerNodeCreate(e){this._containerNode=e,this.addHandles(I(e,t=>{const{width:i,height:n}=t.contentRect;this._containerDimensions={width:i,height:n}}))}_getIndexFromElement(e){var n;const t=(n=e.dataset)==null?void 0:n.index,i=e.getAttribute("data-index");return t!=null?parseInt(t,10):i!=null?parseInt(i,10):null}_afterBarCreate(e){if(this.barCreatedFunction){const t=this._getIndexFromElement(e)??-1;this.barCreatedFunction(t,e)}}_afterLinesSubgroupCreate(e){if(this.dataLineCreatedFunction){const t=this._getIndexFromElement(e),i=e.childNodes[1],n=e.childNodes[2]?e.childNodes[2]:null;this.dataLineCreatedFunction(i,n,t)}}_afterLinesSubgroupUpdate(e){if(this.dataLineUpdatedFunction){const t=this._getIndexFromElement(e),i=e.childNodes[1],n=e.childNodes[2]?e.childNodes[2]:null;this.dataLineUpdatedFunction(i,n,t)}}_getBarDimensions(e,t){const{bins:i,layout:n}=this,r=i?i.map(h=>h.count):[],o=Math.max.apply(Math,r);return r.map(h=>n==="vertical"?[e/r.length,o!==0?h/o*t:0]:[o!==0?h/o*e:0,t/r.length])}_getLinePosition(e){const{layout:t,min:i,viewModel:{range:n}}=this;if(i==null)return[0,0,0,0];const r=Math.round((e-i)/n*100)/100,{width:o,height:h}=this._containerDimensions,[p,b]=[r*o||1,h-r*h||1];return t==="vertical"?[0,"100%",b,b]:[p,p,"100%",0]}_getLabelPosition(e){const{layout:t,min:i,viewModel:{range:n}}=this;if(i==null)return[0,0];const r=Math.round((e-i)/n*100)/100,{width:o,height:h}=this._containerDimensions;return t==="vertical"?[o,h-r*h]:[0,r*o]}};a([s()],l.prototype,"_bgFillId",void 0),a([s()],l.prototype,"_containerNode",void 0),a([s()],l.prototype,"_containerDimensions",void 0),a([s()],l.prototype,"_defaultBarColor",void 0),a([s()],l.prototype,"average",null),a([s()],l.prototype,"barCreatedFunction",void 0),a([s()],l.prototype,"dataLines",void 0),a([s()],l.prototype,"dataLineCreatedFunction",void 0),a([s()],l.prototype,"dataLineUpdatedFunction",void 0),a([s()],l.prototype,"label",null),a([s()],l.prototype,"labelFormatFunction",null),a([s({value:"horizontal"})],l.prototype,"layout",null),a([s()],l.prototype,"max",null),a([s(),D("esri/widgets/Histogram/t9n/Histogram")],l.prototype,"messages",void 0),a([s()],l.prototype,"min",null),a([s({readOnly:!0})],l.prototype,"state",null),a([s()],l.prototype,"viewModel",void 0),l=v=a([f("esri.widgets.Histogram")],l);const E=l;export{E as default};
