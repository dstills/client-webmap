function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/MapImageLayer-Db-ioX8n.js","assets/index-BhDz4nJ7.js","assets/index-CIBc8SyM.css","assets/SublayersOwner-BQQ8bPrE.js","assets/QueryTask-VtIj0FyU.js","assets/executeForIds-pR6YWTwe.js","assets/query-CGw84oGO.js","assets/pbfQueryUtils-Dark8sO6.js","assets/pbf-7bahT4Qy.js","assets/executeQueryJSON-DPxoVYsp.js","assets/executeQueryPBF-UWwGZBUf.js","assets/imageBitmapUtils-0s-fWH2K.js","assets/calcite-combobox-CDCLoPx8.js","assets/combobox-DGwRLq9F.js","assets/filter-CEU3vG1r.js","assets/utils2-DtCwVDOk.js","assets/core-Bizuf87v.js","assets/Validation-DfD77_UB.js","assets/chip-C-Ku3RRi.js","assets/combobox-item-BrI07sWe.js","assets/input-message-Ib1DzjNv.js","assets/calcite-combobox-item-Dod8dX9H.js","assets/calcite-input-CeKi9Nry.js","assets/input2-C4Ui2AtO.js","assets/input-kBVpmtEZ.js","assets/progress-GWQR1wcL.js","assets/calcite-label-CHImFeZn.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{bz as ae,g as l,y as u,i as R,S as be,ar as de,P as $t,bU as Ke,bK as st,ht as Ct,eM as ie,eL as lt,iK as We,c0 as Fe,hs as Mt,aN as Dt,c1 as re,bE as X,rl as Et,aj as he,gT as Vt,lv as He,BO as Ft,cL as te,zT as Nt,zU as kt,Bx as At,bw as Oe,hr as Gt,bW as ue,fh as Rt,j as jt,BP as Jt,ff as Ut,nw as ve,hR as Bt,aL as zt,BQ as Ie,fw as we,D as ne,aO as ut,aq as ct,bA as qt,aH as pt,BR as Qe,ay as Kt,v as Ze,sJ as Wt,sK as Ht,Ab as Qt,cw as Zt,cx as Yt,cy as Xt,cz as d,o9 as F,es as U,qp as ea,aK as ta,k6 as aa,iG as ia,ul as oa}from"./index-BhDz4nJ7.js";import{a as dt}from"./GPMessage-ZMiJ_sIC.js";const Le=new ae({PDF:"pdf",PNG32:"png32",PNG8:"png8",JPG:"jpg",GIF:"gif",EPS:"eps",SVG:"svg",SVGZ:"svgz"}),Se=Le.fromJSON.bind(Le),ht=Le.toJSON.bind(Le);let z=class extends be{constructor(t){super(t),this.state="pending",this.url=""}initialize(){this.addHandles(de(()=>[this.extension,this.name],()=>this._setFormattedFileName(),$t))}_setFormattedFileName(){this.name&&this.extension&&(this.formattedName=this.count?`${this.name}(${this.count})${this.extension}`:`${this.name}.${this.extension}`)}};l([u()],z.prototype,"count",void 0),l([u()],z.prototype,"error",void 0),l([u()],z.prototype,"extension",void 0),l([u()],z.prototype,"formattedName",void 0),l([u()],z.prototype,"name",void 0),l([u()],z.prototype,"state",void 0),l([u()],z.prototype,"url",void 0),z=l([R("esri.widgets.Print.FileLink")],z);const mt=z;var Ne;let q=Ne=class extends be{constructor(e){super(e),this.outSpatialReference=null,this.processExtent=null,this.processSpatialReference=null,this.returnColumnName=!1,this.returnFeatureCollection=!1,this.returnM=!1,this.returnZ=!1}static from(e){return Ct(Ne,e)}};l([u({type:Ke})],q.prototype,"outSpatialReference",void 0),l([u({type:st})],q.prototype,"processExtent",void 0),l([u({type:Ke})],q.prototype,"processSpatialReference",void 0),l([u({nonNullable:!0})],q.prototype,"returnColumnName",void 0),l([u({nonNullable:!0})],q.prototype,"returnFeatureCollection",void 0),l([u({nonNullable:!0})],q.prototype,"returnM",void 0),l([u({nonNullable:!0})],q.prototype,"returnZ",void 0),q=Ne=l([R("esri.rest.geoprocessor.GPOptions")],q);const je=q;let B=class extends ie{constructor(){super(...arguments),this.extent=null,this.height=null,this.href=null,this.opacity=1,this.rotation=0,this.scale=null,this.visible=!0,this.width=null}};l([u({type:st})],B.prototype,"extent",void 0),l([u()],B.prototype,"height",void 0),l([u()],B.prototype,"href",void 0),l([u()],B.prototype,"opacity",void 0),l([u()],B.prototype,"rotation",void 0),l([u()],B.prototype,"scale",void 0),l([u()],B.prototype,"visible",void 0),l([u()],B.prototype,"width",void 0),B=l([R("esri.layer.support.MapImage")],B);const Ye=B;let me=class extends ie{constructor(t){super(t),this.itemId=null,this.url=null}};l([u({type:String,json:{read:{source:"itemID"},write:{target:"itemID"}}})],me.prototype,"itemId",void 0),l([u({type:String,json:{write:!0}})],me.prototype,"url",void 0),me=l([R("esri.rest.support.DataFile")],me);const Ee=me,Xe=new ae({esriMeters:"meters",esriFeet:"feet",esriKilometers:"kilometers",esriMiles:"miles",esriNauticalMiles:"nautical-miles",esriYards:"yards"},{ignoreUnknown:!1});let ye=class extends ie{constructor(t){super(t),this.distance=0,this.units=null}};l([u({json:{write:!0}})],ye.prototype,"distance",void 0),l([u({json:{read:Xe.read,write:Xe.write}})],ye.prototype,"units",void 0),ye=l([R("esri.rest.support.LinearUnit")],ye);const et=ye,ra=new ae({GPBoolean:"boolean",GPDataFile:"data-file",GPDate:"date",GPDouble:"double",GPFeatureRecordSetLayer:"feature-record-set-layer",Field:"field",GPLinearUnit:"linear-unit",GPLong:"long",GPRasterData:"raster-data",GPRasterDataLayer:"raster-data-layer",GPRecordSet:"record-set",GPString:"string",GPValueTable:"value-table","GPMultiValue:GPBoolean":"multi-value-boolean","GPMultiValue:GPDataFile":"multi-value-data-file","GPMultiValue:GPDate":"multi-value-date","GPMultiValue:GPDouble":"multi-value-double","GPMultiValue:GPFeatureRecordSetLayer":"multi-value-feature-record-set-layer","GPMultiValue:Field":"multi-value-field","GPMultiValue:GPLinearUnit":"multi-value-linear-unit","GPMultiValue:GPLong":"multi-value-long","GPMultiValue:GPRasterData":"multi-value-raster-data","GPMultiValue:GPRasterDataLayer":"multi-value-raster-data-layer","GPMultiValue:GPRecordSet":"multi-value-record-set","GPMultiValue:GPString":"multi-value-string"});let se=class extends ie{constructor(t){super(t),this.dataType=null,this.paramName=null,this.value=null}};l([lt(ra,{ignoreUnknown:!1})],se.prototype,"dataType",void 0),l([u()],se.prototype,"paramName",void 0),l([u()],se.prototype,"value",void 0),se=l([R("esri.rest.support.ParameterValue")],se);const na=se;let le=class extends ie{constructor(t){super(t),this.format=null,this.itemId=null,this.url=null}};l([u()],le.prototype,"format",void 0),l([u({json:{read:{source:"itemID"},write:{target:"itemID"}}})],le.prototype,"itemId",void 0),l([u()],le.prototype,"url",void 0),le=l([R("esri.rest.support.RasterData")],le);const tt=le;async function yt(e,t,a,i,o){const r={},n={},p=[];return sa(i,p,r),Dt(p).then(c=>{const{outSpatialReference:s,processExtent:h,processSpatialReference:f,returnColumnName:b,returnFeatureCollection:T,returnM:y,returnZ:S}=a,{path:M}=re(e);for(const N in r){const[k,O]=r[N];n[N]=c.slice(k,O)}const E=s?s.wkid||s:null,v=f?f.wkid||f:null,w=t==="execute"?{returnColumnName:b||void 0,returnFeatureCollection:T||void 0,returnM:y||void 0,returnZ:S||void 0}:null,L=Pe({...h?{context:{extent:h,outSR:E,processSR:v}}:{"env:outSR":E,"env:processSR":v},...i,...w,f:"json"},null,n),j={...o,query:L};return X(`${M}/${t}`,j)})}function sa(e,t,a){for(const i in e){const o=e[i];if(o&&typeof o=="object"&&o instanceof Fe){const{features:r}=o;a[i]=[t.length,t.length+r.length],r.forEach(n=>{t.push(n.geometry)})}}}function ke(e){const t=e.dataType,a=na.fromJSON(e);switch(t){case"GPBoolean":case"GPDouble":case"GPLong":case"GPString":case"GPMultiValue:GPBoolean":case"GPMultiValue:GPDouble":case"GPMultiValue:GPLong":case"GPMultiValue:GPString":return a;case"GPDate":a.value=new Date(a.value);break;case"GPDataFile":a.value=Ee.fromJSON(a.value);break;case"GPLinearUnit":a.value=et.fromJSON(a.value);break;case"GPFeatureRecordSetLayer":case"GPRecordSet":{const i=e.value.url;a.value=i?Ee.fromJSON(a.value):Fe.fromJSON(a.value);break}case"GPRasterData":case"GPRasterDataLayer":{const i=e.value.mapImage;a.value=i?Ye.fromJSON(i):tt.fromJSON(a.value);break}case"Field":a.value=We.fromJSON(a.value);break;case"GPValueTable":break;case"GPMultiValue:GPDate":a.value=a.value.map(i=>new Date(i));break;case"GPMultiValue:GPDataFile":a.value=a.value.map(i=>Ee.fromJSON(i));break;case"GPMultiValue:GPLinearUnit":a.value=a.value.map(i=>et.fromJSON(i));break;case"GPMultiValue:GPFeatureRecordSetLayer":case"GPMultiValue:GPRecordSet":a.value=a.value.map(i=>Fe.fromJSON(i));break;case"GPMultiValue:GPRasterData":case"GPMultiValue:GPRasterDataLayer":a.value=a.value.map(i=>i?Ye.fromJSON(i):tt.fromJSON(a.value));break;case"GPMultiValue:Field":a.value=a.value.map(i=>We.fromJSON(i))}return a}function Pe(e,t,a){for(const i in e){const o=e[i];Array.isArray(o)?e[i]=JSON.stringify(o.map(r=>Pe({item:r},!0).item)):o instanceof Date&&(e[i]=o.getTime())}return Mt(e,t,a)}async function Ae(e,t,a,i){return a=je.from(a||{}),yt(e,"execute",a,t??{},i).then(({data:o})=>{var r,n;return{results:((r=o.results)==null?void 0:r.map(ke))??[],messages:((n=o.messages)==null?void 0:n.map(p=>dt.fromJSON(p)))??[]}})}var _e;const la=Et()({esriJobCancelled:"job-cancelled",esriJobCancelling:"job-cancelling",esriJobDeleted:"job-deleted",esriJobDeleting:"job-deleting",esriJobTimedOut:"job-timed-out",esriJobExecuting:"job-executing",esriJobFailed:"job-failed",esriJobNew:"job-new",esriJobSubmitted:"job-submitted",esriJobSucceeded:"job-succeeded",esriJobWaiting:"job-waiting"},{ignoreUnknown:!1});let W=_e=class extends ie{constructor(e){super(e),this.jobId=null,this.jobStatus=null,this.messages=null,this.progress=null,this.requestOptions=null,this.sourceUrl=null,this._timer=void 0}async cancelJob(e){const{jobId:t,sourceUrl:a}=this,{path:i}=re(a),o={...this.requestOptions,...e,query:{f:"json"}};this._clearTimer();const r=`${i}/jobs/${t}/cancel`,{data:n}=await X(r,o),{messages:p,jobStatus:c,progress:s}=_e.fromJSON(n);return this.set({messages:p,jobStatus:c,progress:s}),this}destroy(){clearInterval(this._timer)}async checkJobStatus(e){const{path:t}=re(this.sourceUrl),a={...this.requestOptions,...e,query:{f:"json"}},i=`${t}/jobs/${this.jobId}`,{data:o}=await X(i,a),{messages:r,jobStatus:n,progress:p}=_e.fromJSON(o);return this.set({messages:r,jobStatus:n,progress:p}),this}async fetchResultData(e,t,a){t=je.from(t||{});const{returnColumnName:i,returnFeatureCollection:o,returnM:r,returnZ:n,outSpatialReference:p}=t,{path:c}=re(this.sourceUrl),s=Pe({returnColumnName:i||null,returnFeatureCollection:o||null,returnM:r||null,returnZ:n||null,outSR:p,returnType:"data",f:"json"},null),h={...this.requestOptions,...a,query:s},f=`${c}/jobs/${this.jobId}/results/${e}`,{data:b}=await X(f,h);return ke(b)}async fetchResultImage(e,t,a){const{path:i}=re(this.sourceUrl),o={...t.toJSON(),f:"json"},r=Pe(o),n={...this.requestOptions,...a,query:r},p=`${i}/jobs/${this.jobId}/results/${e}`,{data:c}=await X(p,n);return ke(c)}async fetchResultMapImageLayer(){const{path:e}=re(this.sourceUrl),t=e.indexOf("/GPServer/"),a=`${e.substring(0,t)}/MapServer/jobs/${this.jobId}`;return new(await he(()=>import("./MapImageLayer-Db-ioX8n.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]))).default({url:a})}async waitForJobCompletion(e={}){const{interval:t=1e3,signal:a,statusCallback:i}=e;return new Promise((o,r)=>{Vt(a,()=>{this._clearTimer(),r(He())}),this._clearTimer();const n=setInterval(()=>{this._timer||r(He()),this.checkJobStatus(this.requestOptions).then(p=>{const{jobStatus:c}=p;switch(this.jobStatus=c,c){case"job-succeeded":this._clearTimer(),o(this);break;case"job-submitted":case"job-executing":case"job-waiting":case"job-new":i&&i(this);break;case"job-cancelled":case"job-cancelling":case"job-deleted":case"job-deleting":case"job-timed-out":case"job-failed":this._clearTimer(),r(this)}})},t);this._timer=n})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};l([u()],W.prototype,"jobId",void 0),l([lt(la,{ignoreUnknown:!1})],W.prototype,"jobStatus",void 0),l([u({type:[dt]})],W.prototype,"messages",void 0),l([u()],W.prototype,"progress",void 0),l([u()],W.prototype,"requestOptions",void 0),l([u({json:{write:!0}})],W.prototype,"sourceUrl",void 0),W=_e=l([R("esri.rest.support.JobInfo")],W);const ua=W;async function ca(e,t,a,i){return a=je.from(a||{}),yt(e,"submitJob",a,t??{},i).then(({data:o})=>{const r=ua.fromJSON(o);return r.sourceUrl=e,r})}const $e=new ae({MAP_ONLY:"map-only","A3 Landscape":"a3-landscape","A3 Portrait":"a3-portrait","A4 Landscape":"a4-landscape","A4 Portrait":"a4-portrait","Letter ANSI A Landscape":"letter-ansi-a-landscape","Letter ANSI A Portrait":"letter-ansi-a-portrait","Tabloid ANSI B Landscape":"tabloid-ansi-b-landscape","Tabloid ANSI B Portrait":"tabloid-ansi-b-portrait"}),fe=$e.fromJSON.bind($e),pa=$e.toJSON.bind($e),Ve="simple-marker",da="picture-marker",at="simple-line",ha="simple-fill",ma="shield-label-symbol",ya="text";function fa(e,t){const{graphic:a,renderer:i,symbol:o}=t,r=o.type;if(r===ya||r===ma||!("visualVariables"in i)||!i.visualVariables)return;const n=i.getVisualVariablesForType("size"),p=i.getVisualVariablesForType("color"),c=i.getVisualVariablesForType("opacity"),s=i.getVisualVariablesForType("rotation"),h=n[0],f=p[0],b=c[0],T=s[0];if(h){const y=r===Ve?o.style:null,S=Ft(h,a,{shape:y});S!=null&&(r===Ve?e.size=te(S):r===da?(e.width=te(S),e.height=te(S)):r===at?e.width=te(S):e.outline&&(e.outline.width=te(S)))}if(f){const y=Nt(f,a);(y&&r===Ve||r===at||r===ha)&&(e.color=y?y.toJSON():void 0)}if(b){const y=kt(b,a);y!=null&&e.color&&(e.color[3]=Math.round(255*y))}T&&(e.angle=-At(i,a))}function ba(){return{layerDefinition:{name:"multipointLayer",geometryType:"esriGeometryMultipoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryMultipoint",features:[]}}}function va(){return{layerDefinition:{name:"polygonLayer",geometryType:"esriGeometryPolygon",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolygon",features:[]}}}function it(){return{layerDefinition:{name:"pointLayer",geometryType:"esriGeometryPoint",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPoint",features:[]}}}function ga(){return{layerDefinition:{name:"polylineLayer",geometryType:"esriGeometryPolyline",drawingInfo:{renderer:null}},featureSet:{geometryType:"esriGeometryPolyline",features:[]}}}function wa(e,t=15){const a=e.canvas.width,i=e.canvas.height,o=e.getImageData(0,0,a,i).data;let r,n,p,c,s,h;e:for(n=i;n--;)for(r=a;r--;)if(o[4*(a*n+r)+3]>t){h=n;break e}if(!h)return null;e:for(r=a;r--;)for(n=h+1;n--;)if(o[4*(a*n+r)+3]>t){s=r;break e}e:for(r=0;r<=s;++r)for(n=h+1;n--;)if(o[4*(a*n+r)+3]>t){p=r;break e}e:for(n=0;n<=h;++n)for(r=p;r<=s;++r)if(o[4*(a*n+r)+3]>t){c=n;break e}return{x:p,y:c,width:s-p,height:h-c}}function Sa(e,t){const a=e.allLayerViews.items;if(t===e.scale)return a.filter(o=>!o.suspended);const i=new Array;for(const o of a)Ta(o.parent)&&!i.includes(o.parent)||!o.visible||t&&"isVisibleAtScale"in o&&!o.isVisibleAtScale(t)||i.push(o);return i}function _a(e){return(e==null?void 0:e.type)==="bing-maps"}function ft(e){return e&&"blendMode"in e&&"effect"in e}function xa(e){return(e==null?void 0:e.type)==="csv"}function Ta(e){return(e==null?void 0:e.declaredClass)==="esri.views.2d.layers.GroupLayerView2D"}function Oa(e){const t=e.layer;if(ft(t)){const a=t.blendMode;if((!a||a==="normal")&&(t.effect||"featureEffect"in e&&e.featureEffect))return!0}return!1}let D=class extends be{constructor(t){super(t),this.attributionVisible=!0,this.exportOptions={width:800,height:1100,dpi:96},this.forceFeatureAttributes=!1,this.format="png32",this.includeCharts=!1,this.includeTables=!1,this.label=null,this.layout="map-only",this.layoutItem=null,this.layoutOptions=null,this.outScale=0,this.report=null,this.reportItem=null,this.reportOptions=null,this.scalePreserved=!0,this.showLabels=!0}};l([u()],D.prototype,"attributionVisible",void 0),l([u()],D.prototype,"exportOptions",void 0),l([u()],D.prototype,"forceFeatureAttributes",void 0),l([u()],D.prototype,"format",void 0),l([u()],D.prototype,"includeCharts",void 0),l([u()],D.prototype,"includeTables",void 0),l([u()],D.prototype,"label",void 0),l([u()],D.prototype,"layout",void 0),l([u({type:Oe})],D.prototype,"layoutItem",void 0),l([u()],D.prototype,"layoutOptions",void 0),l([u()],D.prototype,"outScale",void 0),l([u()],D.prototype,"report",void 0),l([u({type:Oe})],D.prototype,"reportItem",void 0),l([u()],D.prototype,"reportOptions",void 0),l([u()],D.prototype,"scalePreserved",void 0),l([u()],D.prototype,"showLabels",void 0),D=l([R("esri.rest.support.PrintTemplate")],D);const bt=D,Ce=new ae({"Attribute List Letter ANSI A Landscape":"attribute-list-letter-ansi-a-landscape","Attribute List Letter ANSI A Portrait":"attribute-list-letter-ansi-a-portrait","Attribute List With Group Letter ANSI A Landscape":"attribute-list-with-group-letter-ansi-a-landscape","Attribute List With Group Letter ANSI A Portrait":"attribute-list-with-group-letter-ansi-a-portrait","Page per Feature Letter ANSI A Landscape":"page-per-feature-letter-ansi-a-landscape","Page per Feature Letter ANSI A Portrait":"page-per-feature-letter-ansi-a-portrait"});Ce.fromJSON.bind(Ce);const Ia=Ce.toJSON.bind(Ce),ot={Feet:"ft",Kilometers:"km",Meters:"m",Miles:"mi"},rt=new ae({esriFeet:"Feet",esriKilometers:"Kilometers",esriMeters:"Meters",esriMiles:"Miles"}),La=new ae({esriExecutionTypeSynchronous:"sync",esriExecutionTypeAsynchronous:"async"}),Ge=new Map;async function Pa(e,t,a){const i=Ma(e);let o=Ge.get(i);return Promise.resolve().then(()=>o?{data:o.gpMetadata}:(o={gpServerUrl:i,is11xService:!1,legendLayerNameMap:{},legendLayers:[]},X(i,Gt({f:"json"},a)))).then(r=>(o.gpMetadata=r.data,o.cimVersion=o.gpMetadata.cimVersion,o.is11xService=!!o.cimVersion,Ge.set(i,o),$a(t,o))).then(r=>{const n=Za(o);let p;const c=s=>{var h,f;return n==="sync"?(f=(h=s.results)==null?void 0:h[0])==null?void 0:f.value:p.fetchResultData("Output_File",null,a).then(b=>b.value)};return n==="async"?ca(e,r,void 0,a).then(s=>(p=s,s.waitForJobCompletion({interval:t.updateDelay}).then(c))):Ae(e,r,void 0,a).then(c)})}async function $a(e,t){var f,b,T,y,S,M,E;t=t||{is11xService:!1,legendLayerNameMap:{},legendLayers:[]};const a=e.template||new bt;a.showLabels==null&&(a.showLabels=!0);const i=a.exportOptions;let o;const r=pa(a.layout);if(i&&(o={dpi:i.dpi},r.toLowerCase()==="map_only"||r==="")){const v=i.width,w=i.height;o.outputSize=v!=null&&w!=null?[v,w]:void 0}const n=a.layoutOptions;let p;if(n){let v,w;n.scalebarUnit==="Miles"||n.scalebarUnit==="Kilometers"?(v="Kilometers",w="Miles"):n.scalebarUnit!=="Meters"&&n.scalebarUnit!=="Feet"||(v="Meters",w="Feet"),p={titleText:n.titleText,authorText:n.authorText,copyrightText:n.copyrightText,customTextElements:n.customTextElements,elementOverrides:n.elementOverrides,scaleBarOptions:{metricUnit:rt.toJSON(v),metricLabel:v?ot[v]:void 0,nonMetricUnit:rt.toJSON(w),nonMetricLabel:w?ot[w]:void 0}}}let c=null;n!=null&&n.legendLayers&&(c=n.legendLayers.map(v=>{const w=v.layerId;t.legendLayerNameMap[w]=v.title;const L={id:w};return v.subLayerIds&&(L.subLayerIds=v.subLayerIds),L}));const s=await Ca(e,a,t);if(s.operationalLayers){const v=new RegExp("[\\u4E00-\\u9FFF\\u0E00-\\u0E7F\\u0900-\\u097F\\u3040-\\u309F\\u30A0-\\u30FF\\u31F0-\\u31FF]"),w=/[\u0600-\u06FF]/,L=N=>{var x;const k=N.text,O=N.font,Z=(x=O==null?void 0:O.family)==null?void 0:x.toLowerCase();k&&O&&(Z==="arial"||Z==="arial unicode ms")&&(O.family=v.test(k)?"Arial Unicode MS":"Arial",O.style!=="normal"&&w.test(k)&&(O.family="Arial Unicode MS"))},j=()=>{throw new ne("print:cim-symbol-unsupported","CIMSymbol is not supported by a print service published from ArcMap")};for(const N of s.operationalLayers)if((f=N.featureCollection)!=null&&f.layers)for(const k of N.featureCollection.layers){if((y=(T=(b=k.layerDefinition)==null?void 0:b.drawingInfo)==null?void 0:T.renderer)!=null&&y.symbol){const O=k.layerDefinition.drawingInfo.renderer;O.symbol.type==="esriTS"?L(O.symbol):O.symbol.type!=="CIMSymbolReference"||t.is11xService||j()}if((S=k.featureSet)!=null&&S.features)for(const O of k.featureSet.features)O.symbol&&(O.symbol.type==="esriTS"?L(O.symbol):O.symbol.type!=="CIMSymbolReference"||t.is11xService||j())}else!t.is11xService&&((E=(M=N.layerDefinition)==null?void 0:M.drawingInfo)!=null&&E.renderer)&&JSON.stringify(N.layerDefinition.drawingInfo.renderer).includes('"type":"CIMSymbolReference"')&&j()}e.outSpatialReference&&(s.mapOptions.spatialReference=e.outSpatialReference.toJSON()),Object.assign(s,{exportOptions:o,layoutOptions:p||{}}),Object.assign(s.layoutOptions,{legendOptions:{operationalLayers:c??t.legendLayers.slice()}}),t.legendLayers.length=0,Ge.set(t.gpServerUrl,t);const h={Web_Map_as_JSON:JSON.stringify(s),Format:ht(a.format),Layout_Template:r,Layout_Item_ID:void 0,Report_Template:Ia(a.report),Report_Item_ID:void 0};if(a.layoutItem){delete h.Layout_Template;const v=a.layoutItem;await v.load(),v.access!=="public"&&ue&&await ue.getCredential(t.gpServerUrl),h.Layout_Item_ID=JSON.stringify({id:v.id})}if(a.reportItem){delete h.Report_Template;const v=a.reportItem;await v.load(),v.access!=="public"&&ue&&await ue.getCredential(t.gpServerUrl),h.Report_Item_ID=JSON.stringify({id:v.id})}return e.extraParameters&&Object.assign(h,e.extraParameters),h}async function Ca(e,t,a){const i=e.view;let o=i.spatialReference;const r={operationalLayers:await Da(i,t,a)};t.includeTables&&(r.tables=await za(i));let n=a.ssExtent||e.extent||i.extent;if(o&&o.isWrappable&&(n=n.clone()._normalize(!0),o=n.spatialReference),r.mapOptions={extent:n&&n.toJSON(),spatialReference:o&&o.toJSON(),showAttribution:t.attributionVisible},a.ssExtent=null,i.background&&(r.background=i.background.toJSON()),i.rotation&&(r.mapOptions.rotation=-i.rotation),t.scalePreserved&&(r.mapOptions.scale=t.outScale||i.scale),i.timeExtent!=null){const p=i.timeExtent.start!=null?i.timeExtent.start.getTime():null,c=i.timeExtent.end!=null?i.timeExtent.end.getTime():null;r.mapOptions.time=[p,c]}return t.reportOptions&&(r.reportOptions=t.reportOptions),r}function Ma(e){let t=e;const a=t.lastIndexOf("/GPServer/");return a>0&&(t=t.slice(0,a+9)),t}async function Da(e,t,a){var p;const i=[],o={layerView:null,printTemplate:t,view:e};let r=0;t.scalePreserved&&(r=t.outScale||e.scale);const n=Sa(e,r);for(const c of n){const s=c.layer;if(!s.loaded||(s==null?void 0:s.type)==="group")continue;let h;o.layerView=c,h=Oa(c)?await ce(s,o,a):_a(s)?Ea(s):xa(s)?await Va(s,o,a):(s==null?void 0:s.type)==="feature"?await Fa(s,o,a):(s==null?void 0:s.type)==="geojson"?await Na(s,o,a):(s==null?void 0:s.type)==="graphics"?await ka(s,o,a):(s==null?void 0:s.type)==="imagery"?Aa(s,a):(s==null?void 0:s.type)==="imagery-tile"?await Ga(s,o,a):(s==null?void 0:s.type)==="kml"?await Ra(s,o,a):(s==null?void 0:s.type)==="map-image"?ja(s,o,a):(s==null?void 0:s.type)==="map-notes"?await Ja(o,a):(s==null?void 0:s.type)==="open-street-map"?Ua():(s==null?void 0:s.type)==="stream"?await Ba(s,o,a):(s==null?void 0:s.type)==="tile"?qa(s,a):(s==null?void 0:s.type)==="vector-tile"?await Ka(s,o,a):(s==null?void 0:s.type)==="web-tile"?Wa(s):(s==null?void 0:s.type)==="wms"?Ha(s,a):(s==null?void 0:s.type)==="wmts"?Qa(s):await ce(s,o,a),h&&(Array.isArray(h)?i.push(...h):(h.id=s.id,h.title=a.legendLayerNameMap[s.id]||s.title,h.opacity=c.fullOpacity,h.minScale=s.minScale||0,h.maxScale=s.maxScale||0,ft(s)&&s.blendMode&&s.blendMode!=="normal"&&(h.blendMode=s.blendMode),i.push(h)))}if(r)for(const c of i)c.minScale=0,c.maxScale=0;if((p=e.graphics)!=null&&p.length){const c=await Q(null,e.graphics,t,a);c&&i.push(c)}return i}function Ea(e){return{culture:e.culture,key:e.key,type:"BingMaps"+(e.style==="aerial"?"Aerial":e.style==="hybrid"?"Hybrid":"Road")}}async function Va(e,t,a){e.legendEnabled&&a.legendLayers.push({id:e.id});const i=t.layerView,o=t.printTemplate;let r;return!a.is11xService||i.filter||e.portalItem&&e.portalItem.access!=="public"?Q(e,await Me(i),o,a):(r={type:"CSV"},e.write(r,{origin:"web-map"}),delete r.popupInfo,delete r.layerType,r.showLabels=o.showLabels&&e.labelsVisible,r)}async function Q(e,t,a,i){var M,E,v,w,L,j,N,k,O,Z;let o;const r=va(),n=ga(),p=it(),c=ba(),s=it();if(s.layerDefinition.name="textLayer",delete s.layerDefinition.drawingInfo,e){if(e.declaredClass==="esri.layers.FeatureLayer"||e.declaredClass==="esri.layers.StreamLayer"?r.layerDefinition.name=n.layerDefinition.name=p.layerDefinition.name=c.layerDefinition.name=i.legendLayerNameMap[e.id]||e.get("arcgisProps.title")||e.title:e.declaredClass==="esri.layers.GraphicsLayer"&&(t=e.graphics.items),e.renderer){const x=e.renderer.toJSON(),_=r.layerDefinition.drawingInfo;_&&(_.renderer=x);const A=n.layerDefinition.drawingInfo;A&&(A.renderer=x);const V=p.layerDefinition.drawingInfo;V&&(V.renderer=x);const G=c.layerDefinition.drawingInfo;G&&(G.renderer=x)}if(a.showLabels&&e.labelsVisible&&typeof e.write=="function"){const x=e.write({},{origin:"web-map"}),_=(E=(M=x.layerDefinition)==null?void 0:M.drawingInfo)==null?void 0:E.labelingInfo;if(_){o=!0;const A=r.layerDefinition.drawingInfo;A&&(A.labelingInfo=_);const V=n.layerDefinition.drawingInfo;V&&(V.labelingInfo=_);const G=p.layerDefinition.drawingInfo;G&&(G.labelingInfo=_);const ge=c.layerDefinition.drawingInfo;ge&&(ge.labelingInfo=_)}}}let h;e!=null&&e.renderer||o||(delete r.layerDefinition.drawingInfo,delete n.layerDefinition.drawingInfo,delete p.layerDefinition.drawingInfo,delete c.layerDefinition.drawingInfo);const f=e==null?void 0:e.fieldsIndex,b=e==null?void 0:e.renderer;if(f){const x=new Set;o&&await Rt(x,e),b&&typeof b.collectRequiredFields=="function"&&await b.collectRequiredFields(x,f),h=Array.from(x);const _=f.fields.map(A=>A.toJSON());r.layerDefinition.fields=_,n.layerDefinition.fields=_,p.layerDefinition.fields=_,c.layerDefinition.fields=_}const T=t==null?void 0:t.length;let y;for(let x=0;x<T;x++){const _=t[x]||t.at(x);if(_.visible===!1||!_.geometry||(y=_.toJSON(),y.hasOwnProperty("popupTemplate")&&delete y.popupTemplate,(v=y.geometry)!=null&&v.z&&delete y.geometry.z,((w=y.symbol)==null?void 0:w.outline)&&y.symbol.outline.type==="esriCLS"&&!i.is11xService))continue;!i.is11xService&&((N=(j=(L=y.symbol)==null?void 0:L.outline)==null?void 0:j.color)!=null&&N[3])&&(y.symbol.outline.color[3]=255);const A=(e==null?void 0:e.renderer)&&("valueExpression"in e.renderer&&e.renderer.valueExpression||"hasVisualVariables"in e.renderer&&e.renderer.hasVisualVariables());if(!y.symbol&&(e!=null&&e.renderer)&&A&&!i.is11xService){const V=e.renderer,G=await V.getSymbolAsync(_);if(!G)continue;y.symbol=G.toJSON(),"hasVisualVariables"in V&&V.hasVisualVariables()&&fa(y.symbol,{renderer:V,graphic:_,symbol:G})}if(y.symbol&&(y.symbol.angle||delete y.symbol.angle,Te(y.symbol)?y.symbol=await xe(y.symbol,i):y.symbol.text&&delete y.attributes),(!a||!a.forceFeatureAttributes)&&(h==null?void 0:h.length)){const V={};for(const G of h)(k=y.attributes)!=null&&k.hasOwnProperty(G)&&(V[G]=y.attributes[G]);y.attributes=V}_.geometry.type==="polygon"?r.featureSet.features.push(y):_.geometry.type==="polyline"?n.featureSet.features.push(y):_.geometry.type==="point"?(O=y.symbol)!=null&&O.text?s.featureSet.features.push(y):p.featureSet.features.push(y):_.geometry.type==="multipoint"?c.featureSet.features.push(y):_.geometry.type==="extent"&&(y.geometry=jt.fromExtent(_.geometry).toJSON(),r.featureSet.features.push(y))}const S=[r,n,c,p,s].filter(x=>x.featureSet.features.length>0);for(const x of S){const _=x.featureSet.features.every(A=>A.symbol);if(_&&(!a||!a.forceFeatureAttributes))for(const A of x.featureSet.features)delete A.attributes;_&&delete x.layerDefinition.drawingInfo,(Z=x.layerDefinition.drawingInfo)!=null&&Z.renderer&&await vt(x.layerDefinition.drawingInfo.renderer,i)}return S.length?{featureCollection:{layers:S},showLabels:o}:null}async function Fa(e,t,a){var b,T,y,S,M,E,v;let i;const o=e.renderer,r=parseFloat(a.cimVersion);if(((b=e.featureReduction)==null?void 0:b.type)==="binning"||((T=e.featureReduction)==null?void 0:T.type)==="cluster"&&(!a.is11xService||r<2.9)||(o==null?void 0:o.type)==="pie-chart"||(o==null?void 0:o.type)==="dot-density"&&(!a.is11xService||r<2.6))return ce(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const n=t.layerView,{printTemplate:p,view:c}=t,s=o&&("valueExpression"in o&&o.valueExpression||"hasVisualVariables"in o&&o.hasVisualVariables()),h=((y=e.source)==null?void 0:y.type)!=="feature-layer"&&((S=e.source)==null?void 0:S.type)!=="ogc-feature";if(!a.is11xService&&s||n.filter||h||!o||"field"in o&&o.field!=null&&(typeof o.field!="string"||!e.getField(o.field))){const w=await Me(n);i=await Q(e,w,p,a)}else{if(i={id:(f=e.write()).id,title:f.title,url:f.url,layerType:f.layerType,customParameters:f.customParameters,layerDefinition:f.layerDefinition,charts:p.includeCharts?f.charts:void 0},i.showLabels=p.showLabels&&e.labelsVisible,pe(i,e),((E=(M=i.layerDefinition)==null?void 0:M.drawingInfo)==null?void 0:E.renderer)&&(delete i.layerDefinition.minScale,delete i.layerDefinition.maxScale,await vt(i.layerDefinition.drawingInfo.renderer,a),"visualVariables"in o&&o.visualVariables&&o.visualVariables[0])){const L=o.visualVariables[0];if(L.type==="size"&&L.maxSize&&typeof L.maxSize!="number"&&L.minSize&&typeof L.minSize!="number"){const j=Jt(L,c.scale);i.layerDefinition.drawingInfo.renderer.visualVariables[0].minSize=j.minSize,i.layerDefinition.drawingInfo.renderer.visualVariables[0].maxSize=j.maxSize}}const w=Ut(n);if(w&&(i.layerDefinition||(i.layerDefinition={}),i.layerDefinition.definitionExpression=i.layerDefinition.definitionExpression?`(${i.layerDefinition.definitionExpression}) AND (${w})`:w),((v=n.hasHighlight)==null?void 0:v.call(n))&&"getHighlightIds"in n){const L=n;i.selectionObjectIds=L.getHighlightIds()}}var f;return i}async function Na(e,t,a){var i,o;return((i=e.featureReduction)==null?void 0:i.type)==="binning"||((o=e.featureReduction)==null?void 0:o.type)==="cluster"?ce(e,t,a):(e.legendEnabled&&a.legendLayers.push({id:e.id}),Q(e,await Me(t.layerView),t.printTemplate,a))}async function ka(e,{printTemplate:t},a){return Q(e,null,t,a)}function Aa(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=e.write()).layerType,customParameters:i.customParameters};var i;if(a.bandIds=e.bandIds,a.compressionQuality=e.compressionQuality,a.format=e.format,a.interpolation=e.interpolation,(e.mosaicRule||e.definitionExpression)&&(a.mosaicRule=e.exportImageServiceParameters.mosaicRule.toJSON()),e.rasterFunction||e.renderer)if(t.is11xService)e.rasterFunction&&(a.renderingRule=e.rasterFunction.toJSON()),e.renderer&&(a.layerDefinition=a.layerDefinition||{},a.layerDefinition.drawingInfo=a.layerDefinition.drawingInfo||{},a.layerDefinition.drawingInfo.renderer=e.renderer.toJSON());else{const o=e.exportImageServiceParameters.combineRendererWithRenderingRule();o&&(a.renderingRule=o.toJSON())}return pe(a,e),a}async function Ga(e,t,a){var r;if(((r=e.renderer)==null?void 0:r.type)==="flow")return ce(e,t,a);e.legendEnabled&&a.legendLayers.push({id:e.id});const i={bandIds:(o=e.write()||{}).bandIds,customParameters:o.customParameters,interpolation:o.interpolation,layerDefinition:o.layerDefinition};var o;return i.layerType="ArcGISImageServiceLayer",pe(i,e),i}async function Ra(e,t,a){const i=t.printTemplate;if(a.is11xService){const c={type:"kml"};return e.write(c,{origin:"web-map"}),delete c.layerType,c.url=ve(e.url),c}const o=[],r=t.layerView;r.allVisibleMapImages.forEach((c,s)=>{const h={id:`${e.id}_image${s}`,type:"image",title:e.id,minScale:e.minScale||0,maxScale:e.maxScale||0,opacity:r.fullOpacity,extent:c.extent};c.href.substr(0,22)==="data:image/png;base64,"?h.imageData=c.href.substr(22):h.url=c.href,o.push(h)});const n=[...r.allVisiblePoints.items,...r.allVisiblePolylines.items,...r.allVisiblePolygons.items],p={id:e.id,...await Q(null,n,i,a)};return o.push(p),o}function ja(e,{view:t},a){var s,h;let i;const o={id:e.id,subLayerIds:[]};let r=[];const n=t.scale,p=f=>{const b=n===0,T=f.minScale===0||n<=f.minScale,y=f.maxScale===0||n>=f.maxScale;if(f.visible&&(b||T&&y))if(f.sublayers)f.sublayers.forEach(p);else{const S=f.toExportImageJSON(),M={id:f.id,name:f.title,layerDefinition:{drawingInfo:S.drawingInfo,definitionExpression:S.definitionExpression,source:S.source}};r.unshift(M),o.subLayerIds.push(f.id)}};var c;return e.sublayers&&e.sublayers.forEach(p),r.length&&(r=r.map(({id:f,name:b,layerDefinition:T})=>({id:f,name:b,layerDefinition:T})),i={layerType:(c=e.write()).layerType,customParameters:c.customParameters},i.layers=r,i.visibleLayers=(h=(s=e.capabilities)==null?void 0:s.exportMap)!=null&&h.supportsDynamicLayers?void 0:o.subLayerIds,pe(i,e),e.legendEnabled&&a.legendLayers.push(o)),i}async function Ja({layerView:e,printTemplate:t},a){const i=[],o=e.layer;if(o.featureCollections!=null)for(const r of o.featureCollections){const n=await Q(r,r.source,t,a);n&&i.push(...n.featureCollection.layers)}else if(o.sublayers!=null)for(const r of o.sublayers){const n=await Q(null,r.graphics,t,a);n&&i.push(...n.featureCollection.layers)}return{featureCollection:{layers:i}}}function Ua(){return{type:"OpenStreetMap"}}async function ce(e,{printTemplate:t,view:a},i){var f;const o={type:"image"},r={format:"png",ignoreBackground:!0,layers:[e]};a.rotation!==0&&(r.rotation=0);const n=i.ssExtent||a.extent.clone();let p=96,c=!0,s=!0;if(t.exportOptions){const b=t.exportOptions;b.dpi!=null&&b.dpi>0&&(p=b.dpi),b.width!=null&&b.width>0&&(c=b.width%2==a.width%2),b.height!=null&&b.height>0&&(s=b.height%2==a.height%2)}if(t.layout==="map-only"&&t.scalePreserved&&(!t.outScale||t.outScale===a.scale)&&p===96&&(!c||!s)&&(r.area={x:0,y:0,width:a.width,height:a.height},c||(r.area.width-=1),s||(r.area.height-=1),!i.ssExtent)){const b=a.toMap(Bt(r.area.width,r.area.height));n.ymin=b.y,n.xmax=b.x,i.ssExtent=n}o.extent=n.clone()._normalize(!0).toJSON();const h=await a.takeScreenshot(r);return o.imageData=(f=zt(h.dataUrl))==null?void 0:f.data,o}async function Ba(e,{layerView:t,printTemplate:a},i){return e.legendEnabled&&i.legendLayers.push({id:e.id}),Q(e,await Me(t),a,i)}async function za(e){var o,r;const t=[],a=[];for(const n of e.map.allTables)n.type!=="feature"||n.loaded||a.push(n.load());a.length&&await Promise.allSettled(a);for(const n of e.map.allTables)if(n.type==="feature"&&n.loaded&&n.isTable&&((o=n.source)==null?void 0:o.type)==="feature-layer"){const p={id:(i=n.write()).id,title:i.title,customParameters:i.customParameters,layerDefinition:{definitionExpression:(r=i.layerDefinition)==null?void 0:r.definitionExpression},url:i.url};pe(p,n),t.push(p)}var i;return t.length?t:void 0}function qa(e,t){e.legendEnabled&&t.legendLayers.push({id:e.id});const a={layerType:(i=e.write()).layerType,customParameters:i.customParameters};var i;return pe(a,e),a}async function Ka(e,t,a){if(a.is11xService&&e.serviceUrl&&e.styleUrl){const i=Ie(e.styleUrl,e.apiKey),o=Ie(e.serviceUrl,e.apiKey);if(!i&&!o||a.cimVersion!=="2.1.0"){const r={type:"VectorTileLayer"};return r.styleUrl=ve(e.styleUrl),r.token=i,o!==i&&(r.additionalTokens=[{url:e.serviceUrl,token:o}]),r}}return ce(e,t,a)}function Wa(e){var i;const t=(i=e.urlTemplate)==null?void 0:i.replace(/\${/g,"{"),a={type:"WebTiledLayer",urlTemplate:t,credits:e.copyright};return e.subDomains&&e.subDomains.length>0&&(a.subDomains=e.subDomains),a}function Ha(e,t){let a;const i=[],o=r=>{r.visible&&(r.sublayers?r.sublayers.forEach(o):r.name&&i.unshift(r.name))};return e.sublayers&&e.sublayers.forEach(o),i.length&&(e.legendEnabled&&t.legendLayers.push({id:e.id,subLayerIds:i}),a={type:"wms",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,transparentBackground:e.imageTransparency,visibleLayers:i,url:ve(e.url),version:e.version}),a}function Qa(e){const t=e.activeLayer;return{type:"wmts",customLayerParameters:e.customLayerParameters,customParameters:e.customParameters,format:t.imageFormat,layer:t.id,style:t.styleId,tileMatrixSet:t.tileMatrixSetId,url:ve(e.url)}}function pe(e,t){t.url&&(e.url=ve(e.url||t.url),e.token=Ie(e.url,t.apiKey))}async function xe(e,t){var n;t.canvas||(t.canvas=document.createElement("canvas"));const a=1024;t.canvas.width=a,t.canvas.height=a;const i=t.canvas.getContext("2d");let o,r;if(e.path){const p=new Path2D(e.path);p.closePath(),i.fillStyle=Array.isArray(e.color)?`rgba(${e.color[0]},${e.color[1]},${e.color[2]},${e.color[3]/255})`:"rgb(0,0,0)",i.fill(p);const c=wa(i);if(!c)return null;i.clearRect(0,0,a,a);const s=we(e.size)/Math.max(c.width,c.height);i.scale(s,s);const h=a/s,f=h/2-c.width/2-c.x,b=h/2-c.height/2-c.y;if(i.translate(f,b),Array.isArray(e.color)&&i.fill(p),((n=e.outline)==null?void 0:n.width)&&Array.isArray(e.outline.color)){const y=e.outline;i.lineWidth=we(y.width)/s,i.lineJoin="round",i.strokeStyle=`rgba(${y.color[0]},${y.color[1]},${y.color[2]},${y.color[3]/255})`,i.stroke(p),c.width+=i.lineWidth,c.height+=i.lineWidth}c.width*=s,c.height*=s;const T=i.getImageData(a/2-c.width/2,a/2-c.height/2,Math.ceil(c.width),Math.ceil(c.height));o=T.width,r=T.height,i.canvas.width=o,i.canvas.height=r,i.putImageData(T,0,0)}else{const p=e.contentType==="image/svg+xml"?"data:image/svg+xml;base64,"+e.imageData:e.url,c=(await X(p,{responseType:"image"})).data;o=we(e.width),r=we(e.height),i.canvas.width=o,i.canvas.height=r,i.drawImage(c,0,0,i.canvas.width,i.canvas.height)}return{type:"esriPMS",imageData:i.canvas.toDataURL("image/png").substr(22),angle:e.angle,contentType:"image/png",height:te(r),width:te(o),xoffset:e.xoffset,yoffset:e.yoffset}}async function vt(e,t){const a=e.type;if(a==="simple"&&Te(e.symbol))e.symbol=await xe(e.symbol,t);else if(a==="uniqueValue"||a==="classBreaks"){Te(e.defaultSymbol)&&(e.defaultSymbol=await xe(e.defaultSymbol,t));const i=e[a==="uniqueValue"?"uniqueValueInfos":"classBreakInfos"];if(i)for(const o of i)Te(o.symbol)&&(o.symbol=await xe(o.symbol,t))}}async function Me(e){return e.queryFeatures(e.createQuery()).then(t=>t.features)}function Za(e){var t;return(t=e.gpMetadata)!=null&&t.executionType?La.fromJSON(e.gpMetadata.executionType):"sync"}function Te(e){var t;return e&&(e.path||e.contentType==="image/svg+xml"||((t=e.url)==null?void 0:t.endsWith(".svg")))}let H=class extends be{constructor(t){super(t),this.extent=null,this.extraParameters=null,this.outSpatialReference=null,this.template=null,this.updateDelay=1e3,this.view=null}};l([u()],H.prototype,"extent",void 0),l([u()],H.prototype,"extraParameters",void 0),l([u()],H.prototype,"outSpatialReference",void 0),l([u()],H.prototype,"template",void 0),l([u()],H.prototype,"updateDelay",void 0),l([u()],H.prototype,"view",void 0),H=l([R("esri.rest.support.PrintParameters")],H);const Ya=H;let K=class extends ie{constructor(e){super(e),this.description=null,this.format=null,this.label=null,this.layout=null,this.layoutItem=null,this.layoutOptions=null,this.layoutTemplateInfo=null}};l([u()],K.prototype,"description",void 0),l([u({json:{read:Se}})],K.prototype,"format",void 0),l([u()],K.prototype,"label",void 0),l([u({json:{read:fe}})],K.prototype,"layout",void 0),l([u({type:Oe})],K.prototype,"layoutItem",void 0),l([u()],K.prototype,"layoutOptions",void 0),l([u()],K.prototype,"layoutTemplateInfo",void 0),K=l([R("esri.widgets.Print.CustomTemplate")],K);const Re=K,gt=ut.ofType(Re);function Xa(e){var a;e.layoutOptions??(e.layoutOptions={}),(a=e.layoutOptions).customTextElements??(a.customTextElements=[]);const t="date";if(!e.layoutOptions.customTextElements.find(i=>t in i)){const{customTextElements:i}=e.layoutOptions;let o=Wt(Date.now(),Ht("short-date"));Qt()==="ar"&&(o="‏"+o),i.push({date:o})}}let P=class extends qt{constructor(t){super(t),this._serviceTemplateCustomTextElements=null,this.allowedFormats="all",this.allowedLayouts="all",this.defaultTemplates=new gt,this.error=null,this.extraParameters=null,this.includeDefaultTemplates=!0,this.portal=ct.getDefault(),this.printServiceUrl=null,this.printTimeout=12e4,this.templatesInfo=null,this.updateDelay=1e3,this.view=null,this.templateCustomTextElements=null}destroy(){this.view=null}get effectivePrintServiceUrl(){return this.printServiceUrl??null}get effectiveTemplateCustomTextElements(){if(!this._serviceTemplateCustomTextElements)return{};const t=pt(this._serviceTemplateCustomTextElements);return this.templateCustomTextElements&&Object.keys(this.templateCustomTextElements).forEach(a=>{var o;const i=t[a];if(i){const r=(o=this.templateCustomTextElements)==null?void 0:o[a];i.forEach(n=>{const[p]=Object.entries(n)[0];r==null||r.forEach(c=>{const[s,h]=Object.entries(c)[0];p===s&&(n[p]=h)})})}}),Object.freeze(t)}get state(){var t;return this.loadStatus==="loading"?"initializing":this.loadStatus==="failed"||this.error?"error":this.loadStatus==="loaded"&&((t=this.view)!=null&&t.ready)?"ready":"disabled"}async load(t){return this.addResolvingPromise(this._loadResources(t).catch(a=>this.error=a)),this}async getLayoutTemplateInfo(t,a){const{id:i}=t;t.access!=="public"&&ue&&await ue.getCredential(this._printServiceLayoutsUrl);const o={Layout_Item_ID:JSON.stringify({id:i})},{results:r}=await Ae(this._printServiceLayoutsUrl,o,null,a),n=r[0].value[0],p=n.layoutOptions.mapSurroundInfos.find(({type:c})=>c==="CIMMarkerNorthArrow");return p&&(this.templateToNorthArrowInfo[i]=p),n}async print(t){const{view:a,extraParameters:i,updateDelay:o}=this;if(!a)throw new ne("print:view-required","view is not set");Xa(t);const r=new Ya({view:a,template:t,extraParameters:i,updateDelay:o});try{return await Pa(this.effectivePrintServiceUrl,r,{timeout:this.printTimeout})}catch(n){throw new ne("print:export-error","An error occurred while exporting the web map.",{error:n})}}toPrintTemplate({attributionEnabled:t,author:a,copyright:i,customTextElements:o,dpi:r,forceFeatureAttributes:n,format:p,height:c,includeTables:s,layout:h,layoutItem:f,legendEnabled:b,northArrowEnabled:T,scale:y,scaleEnabled:S,title:M,width:E}){const v=new bt({attributionVisible:t,forceFeatureAttributes:n,format:p,includeTables:s,layout:h,layoutItem:f,layoutOptions:{authorText:a||"",copyrightText:i||"",customTextElements:o,titleText:M||""},outScale:y??0,scalePreserved:S});E&&(v.exportOptions.width=E),c&&(v.exportOptions.height=c),r&&(v.exportOptions.dpi=r),!b&&v.layoutOptions&&(v.layoutOptions.legendLayers=[]);const w=this.templateToNorthArrowInfo[(f==null?void 0:f.id)??h];return w&&w.visible!==T&&v.layoutOptions&&(v.layoutOptions.elementOverrides={[w.name]:{visible:T}}),v}async _loadResources(t){var n,p,c;let a=[];if(!this.printServiceUrl){if(this.destroyed)return;try{await this.portal.load(t)}catch(h){throw new ne("print:could-not-load-portal","Cannot load print resource information from portal",{error:h,url:this.effectivePrintServiceUrl})}const s=(n=this.portal.helperServices)==null?void 0:n.printTask;s&&(this._set("effectivePrintServiceUrl",s.url),a=((p=s.templates)==null?void 0:p.map(h=>Re.fromJSON(h)))??[])}this.defaultTemplates.addMany(a);const i=(c=this.effectivePrintServiceUrl)==null?void 0:c.toLowerCase().split("/");if(!(i!=null&&i.includes("gpserver")))throw new ne("print:invalid-print-service-url","Can't fetch print templates information from provided URL",{url:this.effectivePrintServiceUrl});const[o,r]=await Promise.all([this._getPrintServiceLayouts(t),this._getPrintServiceTemplates(t)]);if(this._processPrintServiceLayouts(o),this._processPrintServiceTemplates(r),!this.printServiceUrl){const s=await this._getPortalCustomTemplates(t);this.defaultTemplates.addMany(s)}}async _getPortalCustomTemplates(t){const{layoutGroupQuery:a}=this.portal;if(!a)return[];const i=new Qe({query:a,disableExtraQuery:!0}),o=await this.portal.queryGroups(i,t);if(!o.total)return[];const r=o.results[0],n=new Qe({num:100,query:"type:Layout"}),p=(await r.queryItems(n,t)).results;return p.length?p.map(c=>new Re({label:c.title,layoutItem:c})):[]}_processPrintServiceTemplates(t){this._set("templatesInfo",t)}async _getPrintServiceLayouts(t){let a=[];const i=async o=>(this._printServiceLayoutsUrl=this.effectivePrintServiceUrl.replace(/(\/GPServer\/).+/i,`$1${encodeURI(o)}`),(await Ae(this._printServiceLayoutsUrl,null,null,t)).results[0].value);try{a=await i("Get Layout Templates Info Task")}catch{}if(!a||a.length<1)try{a=await i("Get Layout Templates Info")}catch{}return a}_processPrintServiceLayouts(t){const a={},i={};t.forEach(({layoutTemplate:o,layoutOptions:{customTextElements:r,mapSurroundInfos:n}})=>{const p=fe(o);a[p]=r,n&&(i[p]=n.find(({type:c})=>c==="CIMMarkerNorthArrow"))}),this._serviceTemplateCustomTextElements=Object.freeze(a),this.templateToNorthArrowInfo=i}async _getPrintServiceTemplates(t){let a;try{({data:a}=await X(this.effectivePrintServiceUrl,{...t,query:{f:"json"},timeout:this.printTimeout}))}catch(n){throw Kt(n)?n:new ne("print:unavailable-service-info","Can't fetch templates info from service",{error:n})}const{parameters:i}=a,o=i.find(({name:n})=>n==="Format"),r=i.find(({name:n})=>n==="Layout_Template");return{format:this._getFormat(o),layout:this._getLayout(r)}}_getFormat(t){const a=this.allowedFormats==="all"?t.choiceList:t.choiceList.filter(n=>this.allowedFormats.includes(Se(n))),i=(a.length?a:t.choiceList).map(Se).filter(Ze),o=Se(t.defaultValue),r=i.includes(o)?o:i[0];return{choiceList:i,defaultValue:r}}_getLayout(t){const a=t.choiceList.filter(p=>p.toLowerCase()!=="map_only"),i=this.allowedLayouts==="all"?a:a.filter(p=>this.allowedLayouts.includes(fe(p))),o=(i.length?i:a).map(fe).filter(Ze),r=fe(t.defaultValue),n=o.includes(r)?r:o.find(p=>/(?=.*letter)(?=.*landscape)/i.test(p))??o.find(p=>/(?=.*a4)(?=.*landscape)/i.test(p))??o[0];return{choiceList:o,defaultValue:n}}};l([u()],P.prototype,"_serviceTemplateCustomTextElements",void 0),l([u()],P.prototype,"allowedFormats",void 0),l([u()],P.prototype,"allowedLayouts",void 0),l([u({type:gt})],P.prototype,"defaultTemplates",void 0),l([u()],P.prototype,"error",void 0),l([u()],P.prototype,"extraParameters",void 0),l([u()],P.prototype,"includeDefaultTemplates",void 0),l([u({readOnly:!0})],P.prototype,"effectivePrintServiceUrl",null),l([u()],P.prototype,"effectiveTemplateCustomTextElements",null),l([u({type:ct})],P.prototype,"portal",void 0),l([u()],P.prototype,"printServiceUrl",void 0),l([u()],P.prototype,"printTimeout",void 0),l([u({readOnly:!0})],P.prototype,"state",null),l([u({readOnly:!0})],P.prototype,"templatesInfo",void 0),l([u()],P.prototype,"updateDelay",void 0),l([u()],P.prototype,"view",void 0),l([u()],P.prototype,"templateCustomTextElements",void 0),l([u()],P.prototype,"templateToNorthArrowInfo",void 0),P=l([R("esri.widgets.Print.PrintViewModel")],P);const wt=P;let $=class extends be{constructor(e){super(e),this.attributionEnabled=!0,this.author=null,this.copyright=null,this.customTextElements=null,this.dpi=96,this.fileName=null,this.forceFeatureAttributes=!1,this.format="pdf",this.height=null,this.includeTables=!0,this.layout="letter-ansi-a-landscape",this.layoutItem=null,this.legendEnabled=!0,this.northArrowEnabled=!1,this.scale=null,this.scaleEnabled=!1,this.title=null,this.width=null}};l([u()],$.prototype,"attributionEnabled",void 0),l([u()],$.prototype,"author",void 0),l([u()],$.prototype,"copyright",void 0),l([u()],$.prototype,"customTextElements",void 0),l([u()],$.prototype,"dpi",void 0),l([u()],$.prototype,"fileName",void 0),l([u()],$.prototype,"forceFeatureAttributes",void 0),l([u()],$.prototype,"format",void 0),l([u()],$.prototype,"height",void 0),l([u()],$.prototype,"includeTables",void 0),l([u()],$.prototype,"layout",void 0),l([u({type:Oe})],$.prototype,"layoutItem",void 0),l([u()],$.prototype,"legendEnabled",void 0),l([u()],$.prototype,"northArrowEnabled",void 0),l([u()],$.prototype,"scale",void 0),l([u()],$.prototype,"scaleEnabled",void 0),l([u()],$.prototype,"title",void 0),l([u()],$.prototype,"width",void 0),$=l([R("esri.widgets.Print.TemplateOptions")],$);const St=$,_t=ut.ofType(mt),xt="MAP_ONLY";var Y;(function(e){e.layout="layoutTab",e.mapOnly="mapOnlyTab"})(Y||(Y={}));const g="esri-print",oe=`${g}__advanced-options-button`,m={base:g,widgetIcon:U.printer,headerTitle:`${g}__header-title`,inputText:`${g}__input-text`,layoutTabList:`${g}__layout-tab-list`,layoutTab:`${g}__layout-tab`,layoutSection:`${g}__layout-section`,mapOnlySection:`${g}__map-only-section`,scaleInput:`${g}__scale-input`,loader:`${g}__loader`,advancedOptionsButton:oe,advancedOptionsButtonContainer:`${oe}-container`,advancedOptionsButtonTitle:`${oe}-title`,advancedOptionsButtonIconOpened:`${oe}-icon--opened`,advancedOptionsButtonIconClosed:`${oe}-icon--closed`,advancedOptionsButtonIconClosed_RTL:`${oe}-icon--closed-rtl`,refreshButton:`${g}__refresh-button`,swapButton:`${g}__swap-button`,printButton:`${g}__export-button`,formSectionContainer:`${g}__form-section-container`,advancedOptionsSection:`${g}__advanced-options-section`,advancedOptionsContainer:`${g}__advanced-options-container`,authorInfoContainer:`${g}__author-info-container`,copyrightInfoContainer:`${g}__copyright-info-container`,exportedFilesContainer:`${g}__export-panel-container`,exportedFilesTitle:`${g}__export-title`,exportedFile:`${g}__exported-file`,exportedFileLink:`${g}__exported-file-link`,exportedFileLinkTitle:`${g}__exported-file-link-title`,heightContainer:`${g}__height-container`,legendInfoContainer:`${g}__legend-info-container`,printWidgetContainer:`${g}__container`,panelContainer:`${g}__panel-container`,scaleInfoContainer:`${g}__scale-info-container`,scaleInputContainer:`${g}__scale-input-container`,sizeContainer:`${g}__size-container`,widthContainer:`${g}__width-container`,panelError:`${g}__panel--error`,exportedFileError:`${g}__exported-file--error`};function ei(e){return{width:Math.round(e*8.3333),height:Math.round(e*11.4583)}}function ti(e){return!isNaN(e)&&e>0}function nt(e){return(e==null?void 0:e.toUpperCase())===xt}let C=class extends Yt{constructor(e,t){super(e,t),this._activeTabFocusRequested=!1,this._advancedOptionsVisibleForLayout=!1,this._advancedOptionsVisibleForMapOnly=!1,this._awaitingServerResponse=!1,this._exportedFileNameMap={},this._layoutTabSelected=!0,this._pendingExportScroll=!1,this._rootNode=null,this.exportedLinks=new _t,this.headingLevel=3,this.iconClass=m.widgetIcon,this.icon=null,this.templateOptions=new St,this.viewModel=new wt,this._onInput=a=>{this._layoutTabSelected?this.templateOptions.title=a.target.value:this.templateOptions.fileName=a.target.value},this._removeLink=a=>{const i=a.currentTarget["data-item"];i&&i.state==="error"&&this.exportedLinks.remove(i)},this._handleLinkClick=a=>{const i=a.currentTarget,{href:o}=i,r=Ie(this.viewModel.effectivePrintServiceUrl);if(!r)return;if(!a.isTrusted)return void a.stopPropagation();a.preventDefault();const n=new URL(o);n.searchParams.set("token",r),i.href=n.href,i.click(),i.href=o},this._focusOnTabChange=this._focusOnTabChange.bind(this)}initialize(){this.addHandles([de(()=>{var i;return[this.templateOptions.format,(i=this.viewModel.templatesInfo)==null?void 0:i.format.defaultValue]},([i,o])=>{if(o&&!i)return void(this.templateOptions.format=o);if(!i||!o||!this.viewModel.templatesInfo||this.viewModel.templatesInfo.format.choiceList.includes(i))return;const r=this.viewModel.templatesInfo.format.choiceList.find(n=>n.toUpperCase().includes(`(${i.toUpperCase()})`));this.templateOptions.format=r??o}),de(()=>{var i;return[this.templateOptions.layout,(i=this.viewModel.templatesInfo)==null?void 0:i.layout.defaultValue]},([i,o])=>{if(o&&!i)return void(this.templateOptions.layout=o);if(!i||!o||!this.viewModel.templatesInfo||(this._layoutTabSelected=!nt(i),!this._layoutTabSelected))return;this.viewModel.templatesInfo.layout.choiceList.includes(i)||(this.templateOptions.layout=o);const r=this.viewModel.effectiveTemplateCustomTextElements[this.templateOptions.layout];this.templateOptions.customTextElements=r?pt(r):null}),de(()=>this.templateOptions.dpi,i=>{i<=0&&(this.templateOptions.dpi=1)}),de(()=>{var i;return(i=this.viewModel.view)==null?void 0:i.scale},i=>{!i||this.templateOptions.scaleEnabled&&this.templateOptions.scale||(this.templateOptions.scale=i)})]);const{height:e,width:t}=this.templateOptions;this.templateOptions.width=t||800,this.templateOptions.height=e||1100;const a=setTimeout(()=>{this._awaitingServerResponse=!0,this.scheduleRender()},500);this.viewModel.load().then(()=>{clearTimeout(a),this._awaitingServerResponse=!1})}loadDependencies(){return Xt({combobox:()=>he(()=>import("./calcite-combobox-CDCLoPx8.js"),__vite__mapDeps([12,13,1,2,14,15,16,17,18,19,20])),"combobox-item":()=>he(()=>import("./calcite-combobox-item-Dod8dX9H.js"),__vite__mapDeps([21,19,1,2,15])),input:()=>he(()=>import("./calcite-input-CeKi9Nry.js"),__vite__mapDeps([22,23,1,2,17,24,20,25])),label:()=>he(()=>import("./calcite-label-CHImFeZn.js"),__vite__mapDeps([26,1,2]))})}get allowedFormats(){return this.viewModel.allowedFormats}set allowedFormats(e){this.viewModel.allowedFormats=e}get allowedLayouts(){return this.viewModel.allowedLayouts}set allowedLayouts(e){this.viewModel.allowedLayouts=e}get error(){return this.viewModel.error}get extraParameters(){return this.viewModel.extraParameters}set extraParameters(e){this.viewModel.extraParameters=e}get includeDefaultTemplates(){return this.viewModel.includeDefaultTemplates}set includeDefaultTemplates(e){this.viewModel.includeDefaultTemplates=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get portal(){return this.viewModel.portal}set portal(e){this.viewModel.portal=e}get printServiceUrl(){return this.viewModel.printServiceUrl}set printServiceUrl(e){this.viewModel.printServiceUrl=e}get templateCustomTextElements(){return this.viewModel.templateCustomTextElements}set templateCustomTextElements(e){this.viewModel.templateCustomTextElements=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){var Ue,Be,ze,qe;const{includeDefaultTemplates:e,messages:t,templateOptions:a,viewModel:i,view:o}=this,{attributionEnabled:r,author:n,copyright:p,dpi:c,format:s,height:h,layout:f,layoutItem:b,legendEnabled:T,northArrowEnabled:y,scaleEnabled:S,scale:M,width:E}=a,v=i.state!=="ready"||this._awaitingServerResponse,w=this._renderTitleOrFileNameSection(),L=d("div",{class:m.formSectionContainer},d("calcite-label",null,t.fileFormatTitle,d("calcite-combobox",{clearDisabled:!0,label:t.formatDefaultOption,maxItems:6,placeholder:t.formatDefaultOption,selectionMode:"single-persist",onCalciteComboboxChange:({target:I})=>{this.templateOptions.format=I.selectedItems[0].value}},(Be=(Ue=i.templatesInfo)==null?void 0:Ue.format)==null?void 0:Be.choiceList.sort().map((I,J)=>d("calcite-combobox-item",{key:`file-format-${J}`,selected:I===this.templateOptions.format,textLabel:ht(I),value:I}))))),j=i.defaultTemplates.length&&e?i.defaultTemplates.toArray().filter(({label:I})=>!nt(I)).sort((I,J)=>(I.label??"")>(J.label??"")?1:-1).map((I,J)=>{var ee;return d("calcite-combobox-item",{"data-item-id":(ee=I.layoutItem)==null?void 0:ee.id,key:`organization-template-${J}`,textLabel:I.label??t.untitled,title:I.description??"",value:I.layout})}):null,N=!((qe=(ze=i.templatesInfo)==null?void 0:ze.layout)!=null&&qe.choiceList.length)||e&&i.defaultTemplates.length?null:i.templatesInfo.layout.choiceList.map(I=>({label:t[I]??I.replaceAll("_"," "),value:I})).sort((I,J)=>I.label>J.label?1:0).map(({label:I,value:J},ee)=>d("calcite-combobox-item",{key:`service-template-${ee}`,selected:J===this.templateOptions.layout,textLabel:I,value:J})),k=d("div",{class:m.formSectionContainer},d("calcite-label",null,t.template,d("calcite-combobox",{clearDisabled:!0,label:t.selectTemplate,maxItems:6,placeholder:t.selectTemplate,selectionMode:"single",onCalciteComboboxChange:({target:I})=>{const J=I.selectedItems[0],ee=J.getAttribute("data-item-id");if(ee){const Pt=this.viewModel.defaultTemplates.find(({layoutItem:De})=>ee===(De==null?void 0:De.id));this._applyTemplate(Pt)}else this._applyTemplate(J.value)}},j,N))),O=d("div",{class:m.formSectionContainer},d("label",null,t.dpi,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-name":"dpi",min:"1",onchange:this._handleDPIChange,tabIndex:0,type:"number",value:`${c}`}))),Z=d("div",{class:this.classes(m.scaleInfoContainer,m.formSectionContainer)},d("label",null,d("input",{bind:this,checked:S,"data-option-name":"scaleEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),t.scale),d("div",{class:m.scaleInputContainer},d("input",{"aria-label":t.scaleLabel,"aria-valuenow":`${M}`,bind:this,class:this.classes(m.inputText,F.input,m.scaleInput),"data-input-name":"scale",disabled:!S,onchange:this._updateInputValue,role:"spinbutton",tabIndex:0,type:"number",value:`${M}`}),d("button",{"aria-label":t.reset,bind:this,class:this.classes(F.widgetButton,m.refreshButton,U.refresh),onclick:this._resetToCurrentScale,tabIndex:0,type:"button"}))),x=this._advancedOptionsVisibleForLayout?d("div",{"aria-labelledby":`${this.id}__advancedOptionsForLayout`,class:m.advancedOptionsContainer},Z,d("div",{class:this.classes(m.authorInfoContainer,m.formSectionContainer)},d("label",null,t.author,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-name":"author",onchange:this._updateInputValue,tabIndex:0,type:"text",value:n??""}))),d("div",{class:this.classes(m.copyrightInfoContainer,m.formSectionContainer)},d("label",null,t.copyright,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-name":"copyright",onchange:this._updateInputValue,tabIndex:0,type:"text",value:p??""}))),O,d("div",{class:this.classes(m.legendInfoContainer,m.formSectionContainer)},d("label",null,d("input",{bind:this,checked:T,"data-option-name":"legendEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),t.legend)),this.viewModel.templateToNorthArrowInfo[(b==null?void 0:b.id)??f]?d("div",{class:this.classes(m.legendInfoContainer,m.formSectionContainer),key:"north-arrow"},d("label",null,d("input",{bind:this,checked:y,"data-option-name":"northArrowEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),t.northArrow)):null,this._renderCustomTextElementSection()):null,_=this._advancedOptionsVisibleForMapOnly?d("div",{"aria-labelledby":`${this.id}__advancedOptionsForMapOnly`,class:m.advancedOptionsContainer},Z,O,d("div",{class:m.formSectionContainer},d("label",null,d("input",{bind:this,checked:r,"data-option-name":"attributionEnabled",onchange:this._toggleInputValue,tabIndex:0,type:"checkbox"}),t.attribution)),this._renderCustomTextElementSection()):null,A=this._layoutTabSelected?d("section",{"aria-labelledby":`${this.id}__layoutTab`,class:m.layoutSection,id:`${this.id}__layoutContent`,key:"esri-print__layoutContent",role:"tabpanel"},d("div",{class:m.panelContainer},w,k,this._layoutTabSelected?L:null),d("div",{class:this.classes(m.panelContainer,m.advancedOptionsSection)},d("button",{"aria-expanded":this._advancedOptionsVisibleForLayout?"true":"false","aria-label":t.advancedOptions,bind:this,class:m.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},d("div",{class:m.advancedOptionsButtonContainer},d("span",{"aria-hidden":"true",class:this.classes(U.rightTriangleArrow,m.advancedOptionsButtonIconClosed)}),d("span",{"aria-hidden":"true",class:this.classes(U.leftTriangleArrow,m.advancedOptionsButtonIconClosed_RTL)}),d("span",{"aria-hidden":"true",class:this.classes(U.downArrow,m.advancedOptionsButtonIconOpened)}),d("span",{class:m.advancedOptionsButtonTitle},t.advancedOptions))),x)):d("section",{"aria-labelledby":`${this.id}__mapOnlyTab`,class:m.mapOnlySection,id:`${this.id}__mapOnlyContent`,key:"esri-print__mapOnlyContent",role:"tabpanel"},d("div",{class:m.panelContainer},w,this._layoutTabSelected?null:L,d("div",{class:this.classes(m.sizeContainer,m.formSectionContainer)},d("div",{class:m.widthContainer},d("label",null,t.width,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-name":"width",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${E}`}))),d("div",{class:m.heightContainer},d("label",null,t.height,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-name":"height",onchange:this._updateInputValue,tabIndex:0,type:"number",value:`${h}`}))),d("button",{"aria-label":t.swap,bind:this,class:this.classes(F.widgetButton,m.swapButton,U.swap),onclick:this._switchInput,tabIndex:0,type:"button"})),d("div",{class:this.classes(m.panelContainer,m.advancedOptionsSection)},d("button",{"aria-expanded":this._advancedOptionsVisibleForMapOnly?"true":"false","aria-label":t.advancedOptions,bind:this,class:m.advancedOptionsButton,onclick:this._showAdvancedOptions,type:"button"},d("div",{class:m.advancedOptionsButtonContainer},d("span",{"aria-hidden":"true",class:this.classes(U.rightTriangleArrow,m.advancedOptionsButtonIconClosed)}),d("span",{"aria-hidden":"true",class:this.classes(U.leftTriangleArrow,m.advancedOptionsButtonIconClosed_RTL)}),d("span",{"aria-hidden":"true",class:this.classes(U.downArrow,m.advancedOptionsButtonIconOpened)}),d("span",{class:m.advancedOptionsButtonTitle},t.advancedOptions))),_))),V=this.exportedLinks.toArray(),G=this._renderExportedLink(V),ge={[F.buttonDisabled]:v||!f&&!s},Je=!o||o.type!=="2d",Tt=d("div",{class:m.panelError},Je?t.sceneViewError:t.serviceError),Ot=d("div",null,d("ul",{bind:this,class:m.layoutTabList,onclick:this._toggleLayoutPanel,onkeydown:this._handleLayoutPanelKeyDown,role:"tablist"},d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${this._layoutTabSelected}`,class:m.layoutTab,"data-tab-id":Y.layout,id:`${this.id}__layoutTab`,role:"tab",tabIndex:0},t.layoutTab),d("li",{afterCreate:this._focusOnTabChange,afterUpdate:this._focusOnTabChange,"aria-selected":`${!this._layoutTabSelected}`,class:m.layoutTab,"data-tab-id":Y.mapOnly,id:`${this.id}__mapOnlyTab`,role:"tab",tabIndex:0},t.mapOnlyTab)),A,d("button",{"aria-label":t.exportDescription,bind:this,class:this.classes(m.printButton,F.button,ge),disabled:v,onclick:this._handlePrintMap,tabIndex:0,type:"button"},t.export),d("div",{afterUpdate:this._scrollExportIntoView,bind:this,class:m.exportedFilesContainer},d(ea,{class:m.exportedFilesTitle,level:this.headingLevel},t.exportText),V.length>0?null:d("div",null,d("div",null,t.exportHint)),G)),It=d("div",{class:m.printWidgetContainer},d("header",{class:m.headerTitle},t.export),this.error||Je||!o?Tt:Ot),Lt=i.state==="initializing"?this._renderLoader():It;return d("div",{bind:this,class:this.classes(m.base,F.widget,F.panel)},Lt)}_renderCustomTextElementSection(){const{customTextElements:e}=this.templateOptions;return e?d("div",{class:m.formSectionContainer,key:"custom-text-elements"},e.map(t=>{const[a,i]=Object.entries(t)[0];return a==="date"?null:d("label",{key:a},a,d("input",{bind:this,class:this.classes(m.inputText,F.input),"data-input-custom":!0,"data-input-name":a,onchange:this._updateInputValue,type:"text",value:i}))})):null}async _applyTemplate(e){var n,p;if(!e)return;if(typeof e=="string")return this.templateOptions.layout=e,void(this.templateOptions.layoutItem=null);if(!e.layoutTemplateInfo&&e.layoutItem)try{this._awaitingServerResponse=!0,e.layoutTemplateInfo=await this.viewModel.getLayoutTemplateInfo(e.layoutItem);const{hasLegend:c,mapSurroundInfos:s}=e.layoutTemplateInfo.layoutOptions,h=s.some(({type:f,visible:b})=>f==="CIMMarkerNorthArrow"&&b);e.layoutOptions={legend:c,northArrow:h}}catch(c){ta.getLogger(this).error(`Failed to load layout info for ${e.label}`,c)}finally{this._awaitingServerResponse=!1}const{format:t,layoutItem:a}=e,i=e.layout??this.templateOptions.layout,o=((n=e.layoutOptions)==null?void 0:n.legend)??this.templateOptions.legendEnabled,r=((p=e.layoutOptions)==null?void 0:p.northArrow)??this.templateOptions.northArrowEnabled;this.templateOptions.set({format:t,layout:i,layoutItem:a,legendEnabled:o,northArrowEnabled:r})}_renderTitleOrFileNameSection(){const{title:e,fileName:t,titlePlaceHolder:a,fileNamePlaceHolder:i}=this.messages,o=this._layoutTabSelected?e:t,r=this._layoutTabSelected?a:i,n=this._layoutTabSelected?this.templateOptions.title:this.templateOptions.fileName;return d("div",{class:m.formSectionContainer},d("calcite-label",null,o,d("calcite-input",{placeholder:r,value:n??"",onCalciteInputInput:this._onInput})))}_focusOnTabChange(e){if(!this._activeTabFocusRequested)return;const t=e.getAttribute("data-tab-id");(t==="layoutTab"&&this._layoutTabSelected||t==="mapOnlyTab"&&!this._layoutTabSelected)&&(e.focus(),this._activeTabFocusRequested=!1)}_renderLoader(){const e={[m.loader]:this._awaitingServerResponse};return d("div",{class:this.classes(e),key:"loader"})}_createFileLink(e,t){const a=t||this.messages.untitled,i=e.format.toLowerCase(),o=i.includes("png")?"png":i,r=a+o;return this._exportedFileNameMap[r]!==void 0?this._exportedFileNameMap[r]++:this._exportedFileNameMap[r]=0,new mt({name:a,extension:o,count:this._exportedFileNameMap[r]})}_resetToCurrentScale(){var e;this.templateOptions.scale=(e=this.viewModel.view)==null?void 0:e.scale}_updateCustomTextElementValue(e,t,a){e.find(i=>{const[o]=Object.entries(i)[0];return o===t})[t]=a}_updateInputValue(e){const t=e.target,a=t.getAttribute("data-input-name"),i=!!t["data-input-custom"],{templateOptions:o}=this;if(i)return void this._updateCustomTextElementValue(o.customTextElements,a,t.value);let r;if(t.type==="number"){if(!ti(t.valueAsNumber)){const n=o[a];return void(t.value=`${n}`)}r=t.valueAsNumber}else r=t.value;o[a]=r}_handleDPIChange(e){this._updateInputValue(e);const t=e.currentTarget.valueAsNumber,{height:a,width:i}=ei(t),{templateOptions:o}=this;o.height=a,o.width=i}_handlePrintMap(){var o;this._pendingExportScroll=!0;const{templateOptions:e}=this,t=this.viewModel.toPrintTemplate(e),a=this._layoutTabSelected?(o=t.layoutOptions)==null?void 0:o.titleText:e.fileName,i=this._createFileLink(t,a);this.exportedLinks.add(i),this.emit("submit",{link:i}),this.viewModel.print(t).then(r=>{i.set({url:r&&r.url,state:"ready"})}).catch(r=>{i.set({error:r,state:"error"})}).then(()=>{this.emit("complete",{link:i}),this.scheduleRender()})}_switchInput(){[this.templateOptions.width,this.templateOptions.height]=[this.templateOptions.height,this.templateOptions.width]}_showAdvancedOptions(){this._layoutTabSelected?this._advancedOptionsVisibleForLayout=!this._advancedOptionsVisibleForLayout:this._advancedOptionsVisibleForMapOnly=!this._advancedOptionsVisibleForMapOnly}_scrollExportIntoView(){if(!this._pendingExportScroll)return;this._pendingExportScroll=!1;const e=this._rootNode;if(!e)return;const{clientHeight:t,scrollHeight:a}=e,i=a-t;i>0&&(e.scrollTop=i)}_toggleInputValue(e){const t=e.target,a=t.getAttribute("data-option-name");this.templateOptions[a]=t.checked,a==="scaleEnabled"&&(this.templateOptions[a]||this._resetToCurrentScale())}_renderExportedLink(e){const t=this.messages;return e.map(a=>{const{error:i,url:o,state:r}=a,n=a.formattedName??"",p=r==="error",c=r==="pending",s=r==="ready",h={[F.anchorDisabled]:c||p};let f=o||null;f&&(f=aa(f));const b=ia(o,location.href),T={[U.loadingIndicator]:c,[F.rotating]:c,[U.download]:b&&s,[U.launchLinkExternal]:!b&&s,[U.error]:p,[m.exportedFileError]:p},y={[m.exportedFileError]:p};let S;S=c?t.pending:s?t.ready:t.errorMessage;const M=p?(i==null?void 0:i.name)==="print-task:cim-symbol-unsupported"?t.exportWebMapCIMError:t.exportWebMapError:"";return d("div",{"aria-label":S,class:m.exportedFile,"data-item":a,key:n,onclick:this._removeLink,title:M},d("a",{"aria-label":`${n}. ${t.linkReady}`,class:this.classes(m.exportedFileLink,F.anchor,h),download:n,href:f??"",onclick:this._handleLinkClick,rel:"noreferrer",tabIndex:0,target:"_blank"},d("span",{class:this.classes(T)}),d("span",{class:this.classes(m.exportedFileLinkTitle,y)},n)))})}_toggleLayoutPanel(e){const t=e.target;this._toggleTab(t.getAttribute("data-tab-id"))}_toggleTab(e,t=!0){var a,i;this._layoutTabSelected=e===Y.layout,this.templateOptions.layout=this._layoutTabSelected?((i=(a=this.viewModel.templatesInfo)==null?void 0:a.layout)==null?void 0:i.defaultValue)??"letter-ansi-a-landscape":xt,this.templateOptions.layoutItem=null,t&&(this._activeTabFocusRequested=!0)}_handleLayoutPanelKeyDown(e){const{key:t}=e,a=e.target.getAttribute("data-tab-id");if(oa(t))return this._toggleTab(a),e.preventDefault(),void e.stopPropagation();t!=="ArrowLeft"&&t!=="ArrowRight"||(this._toggleTab(a===Y.layout?Y.mapOnly:Y.layout),e.preventDefault(),e.stopPropagation())}};l([u()],C.prototype,"allowedFormats",null),l([u()],C.prototype,"allowedLayouts",null),l([u()],C.prototype,"error",null),l([u({type:_t})],C.prototype,"exportedLinks",void 0),l([u()],C.prototype,"extraParameters",null),l([u()],C.prototype,"headingLevel",void 0),l([u()],C.prototype,"iconClass",void 0),l([u()],C.prototype,"icon",void 0),l([u()],C.prototype,"includeDefaultTemplates",null),l([u()],C.prototype,"label",null),l([u(),Zt("esri/widgets/Print/t9n/Print")],C.prototype,"messages",void 0),l([u()],C.prototype,"portal",null),l([u()],C.prototype,"printServiceUrl",null),l([u()],C.prototype,"templateCustomTextElements",null),l([u({type:St})],C.prototype,"templateOptions",void 0),l([u()],C.prototype,"view",null),l([u({type:wt})],C.prototype,"viewModel",void 0),C=l([R("esri.widgets.Print")],C);const hi=C;export{hi as default};
